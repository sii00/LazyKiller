import asyncio
from typing import Optional
from datetime import datetime

from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton

import os
import json
from openai import AsyncOpenAI

TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

client = AsyncOpenAI(api_key=OPENAI_API_KEY)


dp = Dispatcher()

# --------- –ë–ê–ó–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ---------
# {user_id: {"category": ..., "style": ..., "day": int, "goal": str?,
#            "done_days": int, "last_done_day": int}}
user_state = {}
waiting_for_custom_goal = set()

# --------- PREMIUM –°–û–°–¢–û–Ø–ù–ò–ï ---------
premium_enabled = set()      # user_ids —Å –≤–∫–ª—é—á—ë–Ω–Ω—ã–º –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º–æ–º (–¥–µ–º–æ)
premium_profile = {}         # {user_id: {...–ø–æ–ª—è –∞–Ω–∫–µ—Ç—ã...}}
premium_setup_stage = {}     # {user_id: int} ‚Äì –Ω–∞ –∫–∞–∫–æ–º –≤–æ–ø—Ä–æ—Å–µ –∞–Ω–∫–µ—Ç—ã —Å–µ–π—á–∞—Å

# --------- –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–Ø ---------
# {user_id: {"time": "HH:MM", "mode": "daily"|"weekdays"}}
reminders = {}

# --------- –ö–õ–ê–í–ò–ê–¢–£–†–´ ---------
main_kb = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="üö≠ –ö—É—Ä–µ–Ω–∏–µ"), KeyboardButton(text="üôà –ú–∞—Å—Ç—É—Ä–±–∞—Ü–∏—è")],
        [KeyboardButton(text="üò¥ –ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è"), KeyboardButton(text="üèãÔ∏è –°–ø–æ—Ä—Ç")],
        [KeyboardButton(text="üìö –£—á—ë–±–∞/—Ä–∞–±–æ—Ç–∞"), KeyboardButton(text="üéØ –î—Ä—É–≥–∞—è —Ü–µ–ª—å")]
    ],
    resize_keyboard=True
)

style_kb = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="üòå Soft"), KeyboardButton(text="üî• Brutal")]
    ],
    resize_keyboard=True
)

MAX_DAYS = 7

# ==============================
#   –ü–†–û–ì–†–ï–°–°-–ë–ê–†
# ==============================

def build_progress_bar(done_days: int, total_days: int = MAX_DAYS, length: int = 10, premium: bool = False) -> str:
    """
    –ü—Ä–æ—Å—Ç–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è ¬´–ª–µ–Ω—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞¬ª.
    """
    done = max(0, min(done_days, total_days))
    ratio = done / total_days if total_days > 0 else 0
    filled = int(round(ratio * length))
    filled = max(0, min(filled, length))

    if premium:
        full_char, empty_char = "üü©", "‚¨ú"
    else:
        full_char, empty_char = "‚ñà", "‚ñë"

    return full_char * filled + empty_char * (length - filled)

# ==============================
#   –°–û–•–†–ê–ù–ï–ù–ò–ï / –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•
# ==============================

DATA_FILE = "data.json"


def save_data():
    data = {
        "user_state": user_state,
        "premium_profile": premium_profile,
        "premium_enabled": list(premium_enabled),
        # —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–µ–ª–∏–∫–æ–º –∫–æ–Ω—Ñ–∏–≥ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
        "reminders": {str(uid): cfg for uid, cfg in reminders.items()},
    }
    try:
        with open(DATA_FILE, "w", encoding="utf-8") as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    except Exception as e:
        print("Save error:", e)


def load_data():
    if not os.path.exists(DATA_FILE):
        return
    try:
        with open(DATA_FILE, "r", encoding="utf-8") as f:
            data = json.load(f)

        user_state_raw = data.get("user_state", {})
        for k, v in user_state_raw.items():
            try:
                user_state[int(k)] = v
            except Exception:
                pass

        premium_profile_raw = data.get("premium_profile", {})
        for k, v in premium_profile_raw.items():
            try:
                premium_profile[int(k)] = v
            except Exception:
                pass

        premium_enabled.update(int(x) for x in data.get("premium_enabled", []))

        # –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (—Å—Ç—Ä–æ–∫–∞ "HH:MM") –∏ –Ω–æ–≤—ã–π (dict)
        reminders_raw = data.get("reminders", {})
        for k, v in reminders_raw.items():
            try:
                uid = int(k)
                if isinstance(v, str):
                    reminders[uid] = {"time": v, "mode": "daily"}
                elif isinstance(v, dict):
                    t = v.get("time")
                    mode = v.get("mode", "daily")
                    if t:
                        reminders[uid] = {"time": t, "mode": mode}
            except Exception:
                pass

        print("Data loaded.")
    except Exception as e:
        print("Load error:", e)


# ==============================
#     –ü–õ–ê–ù–´ –ü–û –î–ù–Ø–ú (FREE)
# ==============================

plans = {
    "smoking": {
        "soft": [
            "–î–µ–Ω—å 1.\n"
            "–°–µ–≥–æ–¥–Ω—è –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—à—å. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ —á–µ—Å—Ç–Ω–æ —É–≤–∏–¥–µ—Ç—å –∫–∞—Ä—Ç–∏–Ω—É.\n"
            "‚Ä¢ –ó–∞–ø–∏—Å—ã–≤–∞–π –ö–ê–ñ–î–£–Æ —Å–∏–≥–∞—Ä–µ—Ç—É: –≤—Ä–µ–º—è, –≥–¥–µ —Ç—ã, —á—Ç–æ –¥–µ–ª–∞–ª, –∫–∞–∫–æ–µ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.\n"
            "–í–µ—á–µ—Ä–æ–º –≥–ª—è–Ω—å –Ω–∞ —Å–ø–∏—Å–æ–∫ ‚Äî –±–µ–∑ –æ—Å—É–∂–¥–µ–Ω–∏—è, –ø—Ä–æ—Å—Ç–æ —Ñ–∞–∫—Ç.",

            "–î–µ–Ω—å 2.\n"
            "‚Ä¢ –ü–µ—Ä–≤—É—é —Å–∏–≥–∞—Ä–µ—Ç—É —Å–¥–≤–∏–≥–∞–µ—à—å –º–∏–Ω–∏–º—É–º –Ω–∞ 1 —á–∞—Å –ø–æ–∑–∂–µ, —á–µ–º –æ–±—ã—á–Ω–æ.\n"
            "‚Ä¢ –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤–æ–π —Å–∏–≥–æ–π: —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã + 5 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã.\n"
            "‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∞–µ—à—å –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Å–∏–≥–∞—Ä–µ—Ç—É.",

            "–î–µ–Ω—å 3.\n"
            "‚Ä¢ –£—Ä–µ–∑–∞–µ—à—å –¥–Ω–µ–≤–Ω—É—é –Ω–æ—Ä–º—É –Ω–∞ 1 —Å–∏–≥–∞—Ä–µ—Ç—É –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –±—ã–ª–æ –≤ –î–µ–Ω—å 1.\n"
            "‚Ä¢ –ó–∞—Ä–∞–Ω–µ–µ —Ä–µ—à–∏, –∫–∞–∫—É—é —Å–∏–≥–∞—Ä–µ—Ç—É —Å–µ–≥–æ–¥–Ω—è —É–±–∏—Ä–∞–µ—à—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –µ–¥—ã –∏–ª–∏ –≤–µ—á–µ—Ä–Ω—é—é).\n"
            "‚Ä¢ –í–º–µ—Å—Ç–æ –Ω–µ—ë: –≤–æ–¥–∞/–∂–≤–∞—á–∫–∞ + 3 –º–∏–Ω—É—Ç—ã –¥—ã—Ö–∞–Ω–∏—è (–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤–¥–æ—Ö‚Äì–≤—ã–¥–æ—Ö).",

            "–î–µ–Ω—å 4.\n"
            "‚Ä¢ –í—ã–±–∏—Ä–∞–µ—à—å –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç, –≥–¥–µ —Å–µ–≥–æ–¥–Ω—è –ù–ï –∫—É—Ä–∏—à—å –≤–æ–æ–±—â–µ: –¥–æ–º–∞ / –∑–∞ –∫–æ–º–ø–æ–º / –≤ –º–∞—à–∏–Ω–µ.\n"
            "‚Ä¢ –ö—É—Ä–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤–Ω–µ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.\n"
            "‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∞–µ—à—å —Å—á–∏—Ç–∞—Ç—å —Å–∏–≥–∞—Ä–µ—Ç—ã.",

            "–î–µ–Ω—å 5.\n"
            "‚Ä¢ –ï—â—ë –º–∏–Ω—É—Å 1 —Å–∏–≥–∞—Ä–µ—Ç–∞ –æ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –Ω–æ—Ä–º—ã –î–Ω—è 1 (—É–∂–µ –º–∏–Ω—É—Å 2).\n"
            "‚Ä¢ –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ç—è–Ω–µ—Ç, ‚Äî —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–ª–æ–∂–∏ –Ω–∞ 10 –º–∏–Ω—É—Ç –∏ –≤ —ç—Ç–æ –≤—Ä–µ–º—è: —Ö–æ–¥—å–±–∞, –≤–æ–¥–∞, –¥–µ–ª–∞ —Ä—É–∫–∞–º–∏.\n"
            "–ï—Å–ª–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Å—ë –µ—â—ë –æ—á–µ–Ω—å —Ç—è–Ω–µ—Ç ‚Äî –∫—É—Ä–∏—à—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—à—å.",

            "–î–µ–Ω—å 6.\n"
            "‚Ä¢ –í—ã–±–∏—Ä–∞–µ—à—å 2 —á–∞—Å–∞, –∫–æ–≥–¥–∞ –æ–±—ã—á–Ω–æ –∫—É—Ä–∏—à—å (–Ω–∞–ø—Ä–∏–º–µ—Ä 10:00‚Äì12:00 –∏–ª–∏ 18:00‚Äì20:00).\n"
            "‚Ä¢ –í —ç—Ç–∏ 2 —á–∞—Å–∞ —Å–µ–≥–æ–¥–Ω—è ‚Äî –ø–æ–ª–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –Ω–∞ —Å–∏–≥–∞—Ä–µ—Ç—ã.\n"
            "‚Ä¢ –û—Ç–º–µ—á–∞–π, –≤ –∫–∞–∫–æ–π –º–æ–º–µ–Ω—Ç –±—ã–ª–æ —Ç—è–∂–µ–ª–µ–µ –≤—Å–µ–≥–æ –∑–∞ –¥–µ–Ω—å –∏ —á—Ç–æ –ø–æ–º–æ–≥–ª–æ –æ—Ç–≤–ª–µ—á—å—Å—è.",

            "–î–µ–Ω—å 7.\n"
            "‚Ä¢ –ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –∑–∞–ø–∏—Å–∏ –∑–∞ –Ω–µ–¥–µ–ª—é: –∫–æ–≥–¥–∞ —Ç—è–Ω–µ—Ç —Å–∏–ª—å–Ω–µ–µ –≤—Å–µ–≥–æ? –£—Ç—Ä–æ, –ø–æ—Å–ª–µ –µ–¥—ã, –Ω–æ—á—å—é?\n"
            "‚Ä¢ –í—ã–ø–∏—à–∏ 2‚Äì3 –≥–ª–∞–≤–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–∞ –∏ 2‚Äì3 –∑–∞–º–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ —Å—Ä–∞–±–æ—Ç–∞–ª–∏.\n"
            "–≠—Ç–æ —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –∞–Ω—Ç–∏-–¥—ã–º –ø–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é."
        ],
        "brutal": [
            "–î–µ–Ω—å 1.\n"
            "–î–æ 15:00 ‚Äî 0 —Å–∏–≥–∞—Ä–µ—Ç.\n"
            "–ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ç—è–Ω–µ—Ç: 20 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π + —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã.\n"
            "–ü–æ—Å–ª–µ 15:00 –º–æ–∂–Ω–æ –∫—É—Ä–∏—Ç—å, –Ω–æ –Ω–µ –±–æ–ª—å—à–µ 50% —Ç–≤–æ–µ–π –æ–±—ã—á–Ω–æ–π –¥–Ω–µ–≤–Ω–æ–π –Ω–æ—Ä–º—ã.",

            "–î–µ–Ω—å 2.\n"
            "‚Ä¢ –°—á–∏—Ç–∞–µ—à—å —Å–≤–æ—é —Å—Ç–∞—Ä—Ç–æ–≤—É—é –Ω–æ—Ä–º—É (—Å–∫–æ–ª—å–∫–æ –∫—É—Ä–∏–ª –¥–æ –Ω–∞—á–∞–ª–∞).\n"
            "‚Ä¢ –°–µ–≥–æ–¥–Ω—è –∫—É—Ä–∏—à—å —Ä–æ–≤–Ω–æ –ø–æ–ª–æ–≤–∏–Ω—É –æ—Ç –Ω–µ—ë.\n"
            "‚Ä¢ –£—Ç—Ä–µ–Ω–Ω—é—é —Å–∏–≥–∞—Ä–µ—Ç—É –∑–∞–º–µ–Ω—è–µ—à—å: –≤–æ–¥–∞, —É–º—ã—Ç—å—Å—è –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–π –≤–æ–¥–æ–π, 5 –º–∏–Ω—É—Ç –±—ã—Å—Ç—Ä–æ–π —Ö–æ–¥—å–±—ã.",

            "–î–µ–Ω—å 3.\n"
            "‚Ä¢ –ó–∞–ø—Ä–µ—Ç –Ω–∞ –∫—É—Ä–µ–Ω–∏–µ –¥–æ–º–∞ –∏ –≤ –º–∞—à–∏–Ω–µ.\n"
            "‚Ä¢ –ö—É—Ä–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å—Ç–æ—è –Ω–∞ —É–ª–∏—Ü–µ, –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –º—É–∑—ã–∫–∏.\n"
            "–°–∏–≥–∞—Ä–µ—Ç–∞ = –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∏—Ç—É–∞–ª, –∞ –Ω–µ —Ñ–æ–Ω –∫ —Å–æ—Ü—Å–µ—Ç—è–º.",

            "–î–µ–Ω—å 4.\n"
            "‚Ä¢ –£–±–∏—Ä–∞–µ—à—å —Å–∞–º—É—é –ª—é–±–∏–º—É—é —Å–∏–≥–∞—Ä–µ—Ç—É –¥–Ω—è (—Ç—É, –±–µ–∑ –∫–æ—Ç–æ—Ä–æ–π ¬´–Ω—É –Ω–∏–∫–∞–∫¬ª).\n"
            "‚Ä¢ –í–º–µ—Å—Ç–æ –Ω–µ—ë: –∫–æ—Ä–æ—Ç–∫–∏–π —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç ‚Äî 30 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π –∏–ª–∏ 1 –º–∏–Ω—É—Ç–∞ –ø–ª–∞–Ω–∫–∏.\n"
            "‚Ä¢ –ó–∞–ø–∏—à–∏, –∫–∞–∫ –Ω–∞ –ø—Å–∏—Ö–∏–∫—É –≤–ª–∏—è–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –º–µ—Å—Ç–æ –±–µ–∑ —Å–∏–≥–∞—Ä–µ—Ç—ã.",

            "–î–µ–Ω—å 5.\n"
            "‚Ä¢ –õ–∏–º–∏—Ç: –Ω–µ –±–æ–ª—å—à–µ 3‚Äì4 —Å–∏–≥–∞—Ä–µ—Ç –∑–∞ –¥–µ–Ω—å (–∏–ª–∏ —Å–≤–æ—ë —á–∏—Å–ª–æ, –Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ).\n"
            "‚Ä¢ –ü–∞—á–∫–∞ –Ω–µ –ª–µ–∂–∏—Ç —Ä—è–¥–æ–º: —É–±–µ—Ä–∏ –µ—ë –≤ —Ä—é–∫–∑–∞–∫/–¥–∞–ª—å–Ω–∏–π –∫–∞—Ä–º–∞–Ω.\n"
            "‚Ä¢ –ö–∞–∂–¥–æ–µ –∫—É—Ä–µ–Ω–∏–µ ‚Äî –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ: –≤—Å—Ç–∞–ª, –¥–æ—à—ë–ª, –ø–æ–∫—É—Ä–∏–ª, –∑–∞–ø–∏—Å–∞–ª.",

            "–î–µ–Ω—å 6.\n"
            "‚Ä¢ –ü–æ–≤—Ç–æ—Ä—è–µ—à—å —Å—Ö–µ–º—É –î–Ω—è 5, –Ω–æ –ø–æ–ø—Ä–æ–±—É–π —É–∂–∞—Ç—å –¥–æ 2‚Äì3 —Å–∏–≥–∞—Ä–µ—Ç.\n"
            "‚Ä¢ –ß–µ—Å—Ç–Ω–æ –æ—Ç–º–µ—Ç—å: –≤ –∫–∞–∫–æ–π –º–æ–º–µ–Ω—Ç —Ç—ã –ø–æ–¥–¥–∞–ª—Å—è —Å–∏–ª—å–Ω–µ–µ –≤—Å–µ–≥–æ –∏ —á—Ç–æ –º–æ–≥ –±—ã —Å–¥–µ–ª–∞—Ç—å –∏–Ω–∞—á–µ.",

            "–î–µ–Ω—å 7.\n"
            "‚Ä¢ –í—ã–ø–∏—à–∏: —Å–∫–æ–ª—å–∫–æ –∫—É—Ä–∏–ª –¥–æ —Å—Ç–∞—Ä—Ç–∞, —Å–∫–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å, –∫–∞–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∏.\n"
            "‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–∏ –Ω–æ–≤—É—é –Ω–æ—Ä–º—É –∏ –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é.\n"
            "–¢—ã –Ω–µ —Å—Ç–∞–ª –∏–¥–µ–∞–ª—å–Ω—ã–º, –Ω–æ —Å—Ç–∞–ª —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–º ‚Äî —ç—Ç–æ —É–∂–µ –¥—Ä—É–≥–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ."
        ]
    },

    "masturbation": {
        "soft": [
            "–î–µ–Ω—å 1.\n"
            "‚Ä¢ –£–¥–∞–ª—è–µ—à—å 2‚Äì3 —Å–∞–º—ã—Ö –æ—á–µ–≤–∏–¥–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–∞: —Å–∞–π—Ç—ã, –ø–æ–¥–ø–∏—Å–∫–∏, –ø–∞–ø–∫–∏, –∑–∞–∫–ª–∞–¥–∫–∏.\n"
            "‚Ä¢ –ù–∏–∫–∞–∫–∏—Ö –≥–µ—Ä–æ–π—Å—Ç–≤, –ø—Ä–æ—Å—Ç–æ –ª—ë–≥–∫–∞—è —á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.",

            "–î–µ–Ω—å 2.\n"
            "‚Ä¢ –í–≤–æ–¥–∏—à—å –ø—Ä–∞–≤–∏–ª–æ: –Ω–µ –ª–µ–∂–∞—Ç—å —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –≤ –∫—Ä–æ–≤–∞—Ç–∏.\n"
            "‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω —Ç–æ–ª—å–∫–æ —Å–∏–¥—è/—Å—Ç–æ—è. –õ—ë–∂–∞ ‚Äî —Ç–æ–ª—å–∫–æ —Å–æ–Ω –∏–ª–∏ –∫–Ω–∏–≥–∞/–∞—É–¥–∏–æ –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.",

            "–î–µ–Ω—å 3.\n"
            "‚Ä¢ –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–∏–ª—å–Ω–∞—è —Ç—è–≥–∞, ‚Äî 10 –º–∏–Ω—É—Ç –ø—Ä–æ–≥—É–ª–∫–∏ –∏–ª–∏ –ª—ë–≥–∫–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è.\n"
            "–î–∞–∂–µ –¥–æ–º–∞: –ø—Ä–æ—Å—Ç–æ —Ö–æ–¥—å–±–∞ –ø–æ –∫–æ–º–Ω–∞—Ç–µ/–∫–≤–∞—Ä—Ç–∏—Ä–µ. –ù—É–∂–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å.",

            "–î–µ–Ω—å 4.\n"
            "‚Ä¢ –ü–∏—à–µ—à—å —Å–ø–∏—Å–æ–∫ –¥–µ–ª, –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ –∑–∞–Ω—è—Ç—å –≥–æ–ª–æ–≤—É –∏ —Ä—É–∫–∏: —Å–ø–æ—Ä—Ç, —É–±–æ—Ä–∫–∞, —Ä–∞–±–æ—Ç–∞, –æ–±—É—á–µ–Ω–∏–µ, —Ö–æ–±–±–∏.\n"
            "‚Ä¢ –í –º–æ–º–µ–Ω—Ç —Ç—è–≥–∏ —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫, –∞ –Ω–µ –±—Ä–∞—É–∑–µ—Ä.",

            "–î–µ–Ω—å 5.\n"
            "‚Ä¢ –ß–∏—Å—Ç–∏—à—å –ª–µ–Ω—Ç—É: –æ—Ç–ø–∏—Å–∫–∞ –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç—Ä–∏–≥–≥–µ—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.\n"
            "‚Ä¢ –õ—é–±—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã/–ø–∞–±–ª–∏–∫–∏, –≥–¥–µ —Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤–æ–∑–±—É–∂–¥–∞–µ—à—å—Å—è, ‚Äî –≤ –º—É—Ç/–∞–Ω—Ñ–æ–ª–ª–æ—É.",

            "–î–µ–Ω—å 6.\n"
            "‚Ä¢ –í–≤–æ–¥–∏—à—å –ø—Ä–∞–≤–∏–ª–æ ¬´–Ω–µ —Å–µ–π—á–∞—Å, –∞ —á–µ—Ä–µ–∑ 20 –º–∏–Ω—É—Ç¬ª.\n"
            "–ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ç—è–Ω–µ—Ç, —Å—Ç–∞–≤–∏—à—å —Ç–∞–π–º–µ—Ä –Ω–∞ 20 –º–∏–Ω—É—Ç –∏ –¥–µ–ª–∞–µ—à—å –¥–µ–ª–∞ –∏–∑ —Å–≤–æ–µ–≥–æ —Å–ø–∏—Å–∫–∞.",

            "–î–µ–Ω—å 7.\n"
            "‚Ä¢ –ü–∏—à–µ—à—å: –≤ –∫–∞–∫–∏–µ —á–∞—Å—ã —á–∞—â–µ –≤—Å–µ–≥–æ —Ç—è–Ω–µ—Ç? –∫–∞–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –≥–ª–∞–≤–Ω—ã–µ? –∫–∞–∫–∏–µ –∑–∞–º–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç?\n"
            "–≠—Ç–æ —Ç–≤–æ—è –±–∞–∑–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è, –∞ –Ω–µ —Ö–∞–æ—Å–∞."
        ],
        "brutal": [
            "–î–µ–Ω—å 1.\n"
            "‚Ä¢ –ù–æ–ª—å –ø–æ—Ä–Ω–æ. –í–æ–æ–±—â–µ. –ù–∏–∫–∞–∫–∏—Ö ¬´—á—É—Ç—å-—á—É—Ç—å¬ª.\n"
            "‚Ä¢ –õ—é–±–æ–µ –∂–µ–ª–∞–Ω–∏–µ ‚Äî –∏–ª–∏ —Ç–µ—Ä–ø–∏—à—å, –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—à—å –≤ —Å–ø–æ—Ä—Ç/–¥–µ–ª–∞.",

            "–î–µ–Ω—å 2.\n"
            "‚Ä¢ –ü–æ–ª–Ω–∞—è —á–∏—Å—Ç–∫–∞: –∏—Å—Ç–æ—Ä–∏—è, –∑–∞–∫–ª–∞–¥–∫–∏, –ø–æ–¥–ø–∏—Å–∫–∏, –∞—Ä—Ö–∏–≤—ã. –ë–µ–∑ ¬´–æ—Å—Ç–∞–≤–ª—é –Ω–∞ –≤—Å—è–∫–∏–π¬ª.\n"
            "‚Ä¢ –õ—é–±–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–±—è —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤–æ–∑–±—É–∂–¥–∞–µ—Ç, ‚Äî –≤ –±–∞–Ω.",

            "–î–µ–Ω—å 3.\n"
            "‚Ä¢ –õ—é–±–æ–π —Å–∏–ª—å–Ω—ã–π –ø–æ–∑—ã–≤ = 20 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π –∏–ª–∏ –æ—Ç–∂–∏–º–∞–Ω–∏–π.\n"
            "–¢–µ–ª–æ –¥–∞—ë—Ç —Å–∏–≥–Ω–∞–ª ‚Äî —Ç—ã –æ—Ç–≤–µ—á–∞–µ—à—å –¥–µ–π—Å—Ç–≤–∏–µ–º, –∞ –Ω–µ —Å–ª–∏–≤–æ–º.",

            "–î–µ–Ω—å 4.\n"
            "‚Ä¢ –ü–æ—Å–ª–µ 23:00 ‚Äî –Ω–æ–ª—å —Å–æ—Ü—Å–µ—Ç–µ–π –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.\n"
            "‚Ä¢ –¢–æ–ª—å–∫–æ —Å–ø–æ–∫–æ–π–Ω–∞—è –º—É–∑—ã–∫–∞/–∞—É–¥–∏–æ/–∫–Ω–∏–≥–∞. –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –∫—Ä–æ–≤–∞—Ç–∏.",

            "–î–µ–Ω—å 5.\n"
            "‚Ä¢ –ú–∏–Ω–∏–º—É–º 40 –º–∏–Ω—É—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Å–ø–æ—Ä—Ç/–¥–µ–ª–∞), —á—Ç–æ–±—ã —Å–Ω—è—Ç—å –ª–∏—à–Ω–µ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.\n"
            "–ß–µ–º –º–µ–Ω—å—à–µ –ø—É—Å—Ç–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –≤ —Ç–µ–ª–µ ‚Äî —Ç–µ–º –º–µ–Ω—å—à–µ —à–∞–Ω—Å–æ–≤ —Å–æ—Ä–≤–∞—Ç—å—Å—è.",

            "–î–µ–Ω—å 6.\n"
            "‚Ä¢ –ù–µ –ª–µ–∂–∏—à—å —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –≤–æ–æ–±—â–µ. –õ–µ–∂–∏—à—å ‚Äî –∑–Ω–∞—á–∏—Ç —Å–ø–∏—à—å.\n"
            "‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω ‚Äî —Ç–æ–ª—å–∫–æ –≤ —Å–∏–¥—è—á–µ–º/—Å—Ç–æ—è—á–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∫—É.",

            "–î–µ–Ω—å 7.\n"
            "‚Ä¢ –ñ—ë—Å—Ç–∫–∏–π —Ä–∞–∑–±–æ—Ä: –∫–∞–∫–∏–µ –¥–Ω–∏ –±—ã–ª–∏ —Å–∏–ª—å–Ω—ã–º–∏, –∫–∞–∫–∏–µ ‚Äî –ø—Ä–æ–≤–∞–ª—å–Ω—ã–º–∏.\n"
            "‚Ä¢ –ü–∏—à–µ—à—å 3 –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ—Å—Ç–∞–≤–ª—è–µ—à—å –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é, –∏ —Å–æ–±–ª—é–¥–∞–µ—à—å –∏—Ö –∫–∞–∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç."
        ]
    },

    "procrastination": {
        "soft": [
            "–î–µ–Ω—å 1.\n"
            "‚Ä¢ –í—ã–±–∏—Ä–∞–µ—à—å –æ–¥–Ω–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –¥–µ–ª–æ –Ω–∞ 10 –º–∏–Ω—É—Ç, –∫–æ—Ç–æ—Ä–æ–µ –¥–∞–≤–Ω–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–ª.\n"
            "‚Ä¢ –°—Ç–∞–≤–∏—à—å —Ç–∞–π–º–µ—Ä –Ω–∞ 10 –º–∏–Ω—É—Ç –∏ –¥–µ–ª–∞–µ—à—å —Ç–æ–ª—å–∫–æ –µ–≥–æ.\n"
            "–î–µ–Ω—å –Ω–µ –≤ –Ω–æ–ª—å, –µ—Å–ª–∏ —Å–¥–µ–ª–∞–ª —Ç–æ–ª—å–∫–æ —ç—Ç–æ.",

            "–î–µ–Ω—å 2.\n"
            "‚Ä¢ –í—ã–±–∏—Ä–∞–µ—à—å –æ–¥–Ω–æ –¥–µ–ª–æ –Ω–∞ 10‚Äì15 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ –ü–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º —É–±–∏—Ä–∞–µ—à—å —Ç–µ–ª–µ—Ñ–æ–Ω —Å –ø–æ–ª—è –∑—Ä–µ–Ω–∏—è –∏–ª–∏ –≤–∫–ª—é—á–∞–µ—à—å ¬´–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å¬ª –Ω–∞ 15 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ –ü–æ—Å–ª–µ —Å–ø—Ä–∏–Ω—Ç–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—à—å, —á—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –æ—Ç–≤–ª–µ–∫–∞–ª–æ.",

            "–î–µ–Ω—å 3.\n"
            "‚Ä¢ –î–≤–∞ —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 10‚Äì15 –º–∏–Ω—É—Ç.\n"
            "–ü–µ—Ä–≤—ã–π ‚Äî –ø—Ä–æ—Å—Ç–æ–µ –¥–µ–ª–æ. –í—Ç–æ—Ä–æ–π ‚Äî —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ.\n"
            "–ú–µ–∂–¥—É –Ω–∏–º–∏ 5 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã/—Ä–∞–∑–º–∏–Ω–∫–∏ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.",

            "–î–µ–Ω—å 4.\n"
            "‚Ä¢ –ù–∞ –ø–æ–ª–¥–Ω—è —É–±–∏—Ä–∞–µ—à—å –æ–¥–∏–Ω –≥–ª–∞–≤–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä: TikTok/Reels/YouTube/–∏–≥—Ä—É.\n"
            "‚Ä¢ –î–µ–ª–∞–µ—à—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–ø—Ä–∏–Ω—Ç 15‚Äì20 –º–∏–Ω—É—Ç –ø–æ –≤–∞–∂–Ω–æ–º—É –¥–µ–ª—É.",

            "–î–µ–Ω—å 5.\n"
            "‚Ä¢ –£—Ç—Ä–æ–º –∑–∞–ø–∏—Å—ã–≤–∞–µ—à—å 3 –¥–µ–ª–∞: –≤–∞–∂–Ω–æ–µ, –ø–æ–ª–µ–∑–Ω–æ–µ, –º–µ–ª–æ—á—å.\n"
            "‚Ä¢ –î–µ–Ω—å –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–ª–∏—Ç—ã–º, –µ—Å–ª–∏ —Å–¥–µ–ª–∞–ª —Ö–æ—Ç—è –±—ã –≤–∞–∂–Ω–æ–µ –∏ –º–µ–ª–æ—á—å.",

            "–î–µ–Ω—å 6.\n"
            "‚Ä¢ –û–¥–∏–Ω —Ñ–æ–∫—É—Å-—Å–ø—Ä–∏–Ω—Ç 25 –º–∏–Ω—É—Ç –ø–æ —Ä–µ–∞–ª—å–Ω–æ –≤–∞–∂–Ω–æ–π –∑–∞–¥–∞—á–µ.\n"
            "–ü–æ–∫–∞ —Ç–∞–π–º–µ—Ä –∏–¥—ë—Ç ‚Äî –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è: –Ω–∏ —á–∞—Ç–æ–≤, –Ω–∏ –≤–∫–ª–∞–¥–æ–∫, –Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.",

            "–î–µ–Ω—å 7.\n"
            "‚Ä¢ –ü–∏—à–µ—à—å: –≤ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —Ç–µ–±–µ –ª–µ–≥—á–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞—Ç—å? —á—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ —Å–±–∏–≤–∞–µ—Ç? –∫–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç —Å–ø—Ä–∏–Ω—Ç–æ–≤ –ª—É—á—à–µ –∑–∞—à—ë–ª?\n"
            "–≠—Ç–æ –±–∞–∑–∞ –¥–ª—è —Ç–≤–æ–µ–≥–æ –ª–∏—á–Ω–æ–≥–æ –∞–Ω—Ç–∏-–ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞."
        ],
        "brutal": [
            "–î–µ–Ω—å 1.\n"
            "‚Ä¢ 1 —Å–ø—Ä–∏–Ω—Ç 25 –º–∏–Ω—É—Ç –ø–æ –¥–µ–ª—É, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–ª –º–∏–Ω–∏–º—É–º –Ω–µ–¥–µ–ª—é.\n"
            "–¢–µ–ª–µ—Ñ–æ–Ω –≤ –¥—Ä—É–≥–æ–π –∫–æ–º–Ω–∞—Ç–µ, —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.",

            "–î–µ–Ω—å 2.\n"
            "‚Ä¢ 2 —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 25 –º–∏–Ω—É—Ç.\n"
            "–û–¥–∏–Ω ‚Äî —Å–∞–º–æ–µ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ–µ –¥–µ–ª–æ, –≤—Ç–æ—Ä–æ–π ‚Äî –≤–∞–∂–Ω–æ–µ, –Ω–æ –Ω–µ —Å—Ä–æ—á–Ω–æ–µ.\n"
            "–ú–µ–∂–¥—É –Ω–∏–º–∏ 5‚Äì10 –º–∏–Ω—É—Ç –ø–∞—É–∑–∞ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.",

            "–î–µ–Ω—å 3.\n"
            "‚Ä¢ –í—ã–±–∏—Ä–∞–µ—à—å –æ–¥–Ω—É –±–æ–ª—å—à—É—é –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –≤–∏—Å–µ–ª–∞ –º–µ—Å—è—Ü–∞–º–∏.\n"
            "‚Ä¢ –î–µ–ª–∞–µ—à—å 30-–º–∏–Ω—É—Ç–Ω—ã–π —Å–ø—Ä–∏–Ω—Ç –∏ –¥–≤–∏–≥–∞–µ—à—å –µ—ë —Ö–æ—Ç—è –±—ã –Ω–∞ 20‚Äì30%.",

            "–î–µ–Ω—å 4.\n"
            "‚Ä¢ –ó–∞–ø—Ä–µ—Ç –Ω–∞ —Å–æ—Ü—Å–µ—Ç–∏/–≤–∏–¥–µ–æ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞.\n"
            "–ü–æ–∫–∞ –Ω–µ —Å–¥–µ–ª–∞–ª 25 –º–∏–Ω—É—Ç —Ñ–æ–∫—É—Å–∞ ‚Äî –Ω–∏–∫–∞–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –∫–∞–π—Ñ–∞.",

            "–î–µ–Ω—å 5.\n"
            "‚Ä¢ –î–µ–ª–∏—à—å –¥–µ–Ω—å –Ω–∞ —É—Ç—Ä–æ/–¥–µ–Ω—å/–≤–µ—á–µ—Ä –∏ —Å—Ç–∞–≤–∏—à—å 3 –º–∞–ª–µ–Ω—å–∫–∏–µ –∑–∞–¥–∞—á–∏.\n"
            "‚Ä¢ –ù–µ –∏–¥—ë—à—å —Å–ø–∞—Ç—å, –ø–æ–∫–∞ —Ö–æ—Ç—è –±—ã 2 –∏–∑ 3 –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã.",

            "–î–µ–Ω—å 6.\n"
            "‚Ä¢ –î–µ–Ω—å –¥–æ–±–∏–≤–∞–Ω–∏—è —Ö–≤–æ—Å—Ç–æ–≤.\n"
            "‚Ä¢ –ó–∞–∫—Ä—ã–≤–∞–µ—à—å 2‚Äì3 –º–µ–ª–∫–∏—Ö –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∑–æ–ª—è—Ç –≥–ª–∞–∑ —É–∂–µ –¥–∞–≤–Ω–æ.\n"
            "–û–±—â–∏–π —Ñ–æ–∫—É—Å ‚Äî –º–∏–Ω–∏–º—É–º 40‚Äì60 –º–∏–Ω—É—Ç –∑–∞ –¥–µ–Ω—å.",

            "–î–µ–Ω—å 7.\n"
            "‚Ä¢ –ß–µ—Å—Ç–Ω—ã–π –æ–±–∑–æ—Ä: —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Å–¥–≤–∏–Ω—É–ª–æ—Å—å, –≥–¥–µ —Ç—ã –≤—Å—ë –µ—â—ë —Å–ª–∏–≤–∞–µ—à—å—Å—è.\n"
            "‚Ä¢ –†–µ—à–∏, –∫–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç (1√ó25, 2√ó25, 3√ó15) –æ—Å—Ç–∞–≤–ª—è–µ—à—å –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é."
        ]
    },

    "sport": {
        "soft": [
            "–î–µ–Ω—å 1.\n"
            "10‚Äì12 –º–∏–Ω—É—Ç –ª—ë–≥–∫–æ–π –¥–æ–º–∞—à–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.\n"
            "‚Ä¢ 2 –º–∏–Ω—É—Ç—ã —Ä–∞–∑–º–∏–Ω–∫–∞ (–∫—Ä—É–≥–æ–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è –ø–ª–µ—á–∞–º–∏, —à–µ–µ–π, –∫–∏—Å—Ç—è–º–∏).\n"
            "‚Ä¢ 3√ó10 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–µ—Å–æ–º.\n"
            "‚Ä¢ 3√ó15 –º–∞—Ö–æ–≤ —Ä—É–∫–∞–º–∏ —Å—Ç–æ—è.\n"
            "–ï—Å–ª–∏ —Ç—è–∂–µ–ª–æ ‚Äî –¥–µ–ª–∞–π –ø–æ 5‚Äì6 —Ä–∞–∑, –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∞—Ç—å.",

            "–î–µ–Ω—å 2.\n"
            "12‚Äì15 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ 3 –º–∏–Ω—É—Ç—ã —Ä–∞–∑–º–∏–Ω–∫–∞.\n"
            "‚Ä¢ 3√ó12 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π.\n"
            "‚Ä¢ 3√ó10 –æ—Ç–∂–∏–º–∞–Ω–∏–π –æ—Ç —Å—Ç–µ–Ω—ã –∏–ª–∏ —Å—Ç–æ–ª–∞.\n"
            "‚Ä¢ –õ—ë–≥–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞ –Ω–æ–≥ 2‚Äì3 –º–∏–Ω—É—Ç—ã.",

            "–î–µ–Ω—å 3.\n"
            "15 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ 3 –º–∏–Ω—É—Ç—ã —Ä–∞–∑–º–∏–Ω–∫–∞.\n"
            "‚Ä¢ 3√ó12 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π.\n"
            "‚Ä¢ 3√ó10 –æ—Ç–∂–∏–º–∞–Ω–∏–π –æ—Ç —Å—Ç–æ–ª–∞/–¥–∏–≤–∞–Ω–∞.\n"
            "‚Ä¢ 3√ó20 —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–π –Ω–∞ –ø—Ä–µ—Å—Å –ª—ë–∂–∞ (–∏–ª–∏ –ø–æ–¥—ä—ë–º –∫–æ—Ä–ø—É—Å–∞).",

            "–î–µ–Ω—å 4.\n"
            "15 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ –ü–æ–≤—Ç–æ—Ä–∏ —Ç–æ—Ç –¥–µ–Ω—å, –∫–æ—Ç–æ—Ä—ã–π –æ—â—É—â–∞–ª—Å—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–µ–µ –≤—Å–µ–≥–æ (–î–µ–Ω—å 2 –∏–ª–∏ 3).\n"
            "–¶–µ–ª—å ‚Äî –∑–∞–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É, –∞ –Ω–µ —É–±–∏—Ç—å—Å—è.",

            "–î–µ–Ω—å 5.\n"
            "15‚Äì18 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ 3 –º–∏–Ω—É—Ç—ã —Ä–∞–∑–º–∏–Ω–∫–∞.\n"
            "‚Ä¢ 3√ó15 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π.\n"
            "‚Ä¢ 3√ó12 –æ—Ç–∂–∏–º–∞–Ω–∏–π –æ—Ç –æ–ø–æ—Ä—ã.\n"
            "‚Ä¢ –ü–ª–∞–Ω–∫–∞ 3√ó20 —Å–µ–∫—É–Ω–¥ (–ª–æ–∫—Ç–∏ –Ω–∞ –ø–æ–ª—É –∏–ª–∏ –Ω–∞ –¥–∏–≤–∞–Ω–µ).",

            "–î–µ–Ω—å 6.\n"
            "20 –º–∏–Ω—É—Ç –ª—ë–≥–∫–æ–≥–æ –∫–∞—Ä–¥–∏–æ.\n"
            "‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è —Ö–æ–¥—å–±–∞ –Ω–∞ —É–ª–∏—Ü–µ –∏–ª–∏ –ø–æ –¥–æ–º—É –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫.\n"
            "–ù–µ —Å–∫–æ—Ä–æ—Å—Ç—å –≤–∞–∂–Ω–∞, –∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å.",

            "–î–µ–Ω—å 7.\n"
            "10‚Äì15 –º–∏–Ω—É—Ç —Ä–∞—Å—Ç—è–∂–∫–∏.\n"
            "‚Ä¢ –ú—è–≥–∫–æ –ø–æ—Ç—è–Ω–∏ –Ω–æ–≥–∏, —Å–ø–∏–Ω—É, –ø–ª–µ—á–∏.\n"
            "–ë–µ–∑ —Ä—ã–≤–∫–æ–≤, –±–µ–∑ –±–æ–ª–∏. –ü—Ä–æ—Å—Ç–æ –¥–∞–π —Ç–µ–ª—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è."
        ],
        "brutal": [
            "–î–µ–Ω—å 1.\n"
            "20 –º–∏–Ω—É—Ç –±–∞–∑–æ–≤–æ–≥–æ —Å–∏–ª–æ–≤–æ–≥–æ.\n"
            "‚Ä¢ 3 –º–∏–Ω—É—Ç—ã –∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑–º–∏–Ω–∫–∞.\n"
            "‚Ä¢ 3 –∫—Ä—É–≥–∞: 15 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 10 –æ—Ç–∂–∏–º–∞–Ω–∏–π (–æ—Ç –ø–æ–ª–∞/–∫–æ–ª–µ–Ω/—Å—Ç–æ–ª–∞), 20 —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–π –Ω–∞ –ø—Ä–µ—Å—Å.\n"
            "–û—Ç–¥—ã—Ö 1‚Äì2 –º–∏–Ω—É—Ç—ã –º–µ–∂–¥—É –∫—Ä—É–≥–∞–º–∏.",

            "–î–µ–Ω—å 2.\n"
            "20‚Äì25 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ 3 –º–∏–Ω—É—Ç—ã —Ä–∞–∑–º–∏–Ω–∫–∞.\n"
            "‚Ä¢ 4 –∫—Ä—É–≥–∞: 15 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 12 –æ—Ç–∂–∏–º–∞–Ω–∏–π, 20 —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–π.\n"
            "–ï—Å–ª–∏ —Ç—è–∂–µ–ª–æ ‚Äî —Å–¥–µ–ª–∞–π 3 –∫—Ä—É–≥–∞, –Ω–æ –Ω–µ —Å–ª–∏–≤–∞–π –≤—Å—ë –≤ –Ω–æ–ª—å.",

            "–î–µ–Ω—å 3.\n"
            "20‚Äì25 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ 3 –º–∏–Ω—É—Ç—ã —Ä–∞–∑–º–∏–Ω–∫–∞.\n"
            "‚Ä¢ 3√ó15 –≤—ã–ø–∞–¥–æ–≤ (–ø–æ–æ—á–µ—Ä—ë–¥–Ω–æ –Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–≥—É).\n"
            "‚Ä¢ 3√ó12 –æ—Ç–∂–∏–º–∞–Ω–∏–π.\n"
            "‚Ä¢ –ü–ª–∞–Ω–∫–∞ 3√ó30 —Å–µ–∫—É–Ω–¥.",

            "–î–µ–Ω—å 4.\n"
            "–†–∞–∑–≥—Ä—É–∑–æ—á–Ω—ã–π, –Ω–æ –Ω–µ –ª–µ–∂–∞—á–∏–π.\n"
            "‚Ä¢ 15‚Äì20 –º–∏–Ω—É—Ç –±—ã—Å—Ç—Ä–æ–π —Ö–æ–¥—å–±—ã.\n"
            "‚Ä¢ –õ—ë–≥–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞ –Ω–æ–≥ –∏ —Å–ø–∏–Ω—ã 5 –º–∏–Ω—É—Ç.",

            "–î–µ–Ω—å 5.\n"
            "25 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ 3 –º–∏–Ω—É—Ç—ã —Ä–∞–∑–º–∏–Ω–∫–∞.\n"
            "‚Ä¢ 4 –∫—Ä—É–≥–∞: 15 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 12 –æ—Ç–∂–∏–º–∞–Ω–∏–π, 20 —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–π, –ø–ª–∞–Ω–∫–∞ 20‚Äì30 —Å–µ–∫—É–Ω–¥.\n"
            "–û—Ç–¥—ã—Ö 1‚Äì2 –º–∏–Ω—É—Ç—ã –º–µ–∂–¥—É –∫—Ä—É–≥–∞–º–∏.",

            "–î–µ–Ω—å 6.\n"
            "–§–æ–∫—É—Å –Ω–∞ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å.\n"
            "‚Ä¢ 25‚Äì30 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã/–ª—ë–≥–∫–æ–≥–æ –±–µ–≥–∞/—à–∞–≥–∞ –Ω–∞ –º–µ—Å—Ç–µ.\n"
            "–¢–µ–º–ø —Ç–∞–∫–æ–π, —á—Ç–æ–±—ã –º–æ–∂–µ—à—å –≥–æ–≤–æ—Ä–∏—Ç—å, –Ω–æ –Ω–µ –ø–µ—Ç—å.",

            "–î–µ–Ω—å 7.\n"
            "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.\n"
            "‚Ä¢ 10‚Äì15 –º–∏–Ω—É—Ç —Ä–∞—Å—Ç—è–∂–∫–∏ –≤—Å–µ–≥–æ —Ç–µ–ª–∞.\n"
            "–ó–∞–¥–∞—á–∞ ‚Äî —Å–Ω—è—Ç—å –∑–∞–∂–∏–º—ã –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ–ª–æ –∫ –Ω–æ–≤–æ–π –Ω–µ–¥–µ–ª–µ."
        ]
    },

    "study": {  # –£—á—ë–±–∞ / —Ä–∞–±–æ—Ç–∞
        "soft": [
            "–î–µ–Ω—å 1.\n"
            "‚Ä¢ 1 —Å–ø—Ä–∏–Ω—Ç 20‚Äì25 –º–∏–Ω—É—Ç –ø–æ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ (—É—á—ë–±–∞ –∏–ª–∏ —Ä–∞–±–æ—Ç–∞).\n"
            "‚Ä¢ –ü–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º: –∑–∞–∫—Ä–æ–π –ª–∏—à–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏, —É–±–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω.\n"
            "–¢–≤–æ—è —Ü–µ–ª—å ‚Äî –æ–¥–∏–Ω —á–µ—Å—Ç–Ω—ã–π —Ñ–æ–∫—É—Å-–±–ª–æ–∫.",

            "–î–µ–Ω—å 2.\n"
            "‚Ä¢ 2 —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 20 –º–∏–Ω—É—Ç.\n"
            "–ü–µ—Ä–≤—ã–π ‚Äî –≤–∞–∂–Ω–æ–µ –¥–µ–ª–æ. –í—Ç–æ—Ä–æ–π ‚Äî –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–µ.\n"
            "–ú–µ–∂–¥—É –Ω–∏–º–∏ 5‚Äì10 –º–∏–Ω—É—Ç –ø–∞—É–∑–∞ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.",

            "–î–µ–Ω—å 3.\n"
            "‚Ä¢ –í—ã–ø–∏—Å—ã–≤–∞–µ—à—å 3 –∑–∞–¥–∞—á–∏ –Ω–∞ –¥–µ–Ω—å: 1 –≤–∞–∂–Ω–∞—è, 1 —Å—Ä–µ–¥–Ω—è—è, 1 –º–µ–ª–æ—á—å.\n"
            "‚Ä¢ –î–µ–ª–∞–µ—à—å –º–∏–Ω–∏–º—É–º 2 –∏–∑ –Ω–∏—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–ø—Ä–∏–Ω—Ç–æ–≤ (15‚Äì25 –º–∏–Ω—É—Ç).",

            "–î–µ–Ω—å 4.\n"
            "‚Ä¢ –£–±–∏—Ä–∞–µ—à—å –æ–¥–∏–Ω –≥–ª–∞–≤–Ω—ã–π –æ—Ç–≤–ª–µ–∫–∞—é—â–∏–π —Ñ–∞–∫—Ç–æ—Ä –Ω–∞ 3‚Äì4 —á–∞—Å–∞ (—Å–æ—Ü—Å–µ—Ç–∏, –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã –∏ —Ç.–ø.).\n"
            "‚Ä¢ –î–µ–ª–∞–µ—à—å 1‚Äì2 —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 20‚Äì25 –º–∏–Ω—É—Ç.",

            "–î–µ–Ω—å 5.\n"
            "‚Ä¢ –°—Ç–∞—Ä—Ç—É–µ—à—å –¥–µ–Ω—å —Å —Å–∞–º–æ–≥–æ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ–≥–æ –¥–µ–ª–∞ (–¥–∞–∂–µ –µ—Å–ª–∏ 15 –º–∏–Ω—É—Ç).\n"
            "‚Ä¢ –ü–æ—Ç–æ–º –º–æ–∂–µ—à—å –¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ –ª—ë–≥–∫–∏–µ –∑–∞–¥–∞—á–∏.",

            "–î–µ–Ω—å 6.\n"
            "‚Ä¢ 2‚Äì3 —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 20‚Äì25 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ –ú–µ–∂–¥—É –Ω–∏–º–∏ ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–∞—É–∑—ã –±–µ–∑ –ø—Ä–æ–≤–∞–ª–æ–≤ –≤ TikTok/YouTube.\n"
            "–í–∞–∂–Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ, –∞ –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤.",

            "–î–µ–Ω—å 7.\n"
            "‚Ä¢ –ü–∏—à–µ—à—å: —á—Ç–æ –∑–∞ –Ω–µ–¥–µ–ª—é —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ–¥–≤–∏–Ω—É–ª–æ—Å—å? –∫–∞–∫–∏–µ —á–∞—Å—ã —Å–∞–º—ã–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–µ? —á—Ç–æ —Ç–µ–±—è —á–∞—â–µ –≤—Å–µ–≥–æ —Å–±–∏–≤–∞–µ—Ç?\n"
            "–≠—Ç–∞ –∏–Ω—Ñ–∞ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –¥–ª—è –ø—Ä–µ–º–∏—É–º-–ø–ª–∞–Ω–∞ –∏ AI."
        ],
        "brutal": [
            "–î–µ–Ω—å 1.\n"
            "‚Ä¢ 3 —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 25 –º–∏–Ω—É—Ç.\n"
            "–¢–µ–ª–µ—Ñ–æ–Ω –≤ —Ä–µ–∂–∏–º–µ ¬´–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å¬ª, —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.\n"
            "–¶–µ–ª—å ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–µ–±–µ, —á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –¥–µ—Ä–∂–∞—Ç—å —Ñ–æ–∫—É—Å –ø–æ—á—Ç–∏ —á–∞—Å-–ø–æ–ª—Ç–æ—Ä–∞.",

            "–î–µ–Ω—å 2.\n"
            "‚Ä¢ –°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –¥–µ–ª–æ ‚Äî –ø–µ—Ä–≤—ã–º.\n"
            "‚Ä¢ –ú–∏–Ω–∏–º—É–º 2 —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 25 –º–∏–Ω—É—Ç, –ø–æ–∫–∞ –Ω–µ —Å–¥–≤–∏–Ω–µ—à—å –µ–≥–æ –≤–ø–µ—Ä—ë–¥ —Ö–æ—Ç—è –±—ã –Ω–∞ 20‚Äì30%.",

            "–î–µ–Ω—å 3.\n"
            "‚Ä¢ –í–∫–ª—é—á–∞–µ—à—å —Ä–µ–∂–∏–º —Ç–∏—à–∏–Ω—ã: –º–∏–Ω–∏–º—É–º –≤–Ω–µ—à–Ω–∏—Ö —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª–µ–π.\n"
            "‚Ä¢ 2‚Äì3 —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 25 –º–∏–Ω—É—Ç –Ω–∞–¥ –∑–∞–¥–∞—á–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –¥–≤–∏–≥–∞—é—Ç —Ç–µ–±—è, –∞ –Ω–µ —Å–æ–∑–¥–∞—é—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã.",

            "–î–µ–Ω—å 4.\n"
            "‚Ä¢ –ú–∏–Ω–∏–º—É–º 2 —á–∞—Å–∞ —Ñ–æ–∫—É—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∑–∞ –¥–µ–Ω—å (–º–æ–∂–Ω–æ 4√ó30 –∏–ª–∏ 3√ó40 –º–∏–Ω—É—Ç).\n"
            "‚Ä¢ –ë–µ–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏.",

            "–î–µ–Ω—å 5.\n"
            "‚Ä¢ –†–µ–∂–µ—à—å –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏: –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Ä–∞–¥–∏ –ø–µ—Ä–µ–ø–∏—Å–æ–∫, –ø—É—Å—Ç—ã–µ —Å–æ–∑–≤–æ–Ω—ã, –¥–µ–ª–∞ —Ä–∞–¥–∏ –≥–∞–ª–æ—á–µ–∫.\n"
            "‚Ä¢ –î–µ–ª–∞–µ—à—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª.",

            "–î–µ–Ω—å 6.\n"
            "‚Ä¢ –ü–æ–≤—Ç–æ—Ä –ª—É—á—à–µ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.\n"
            "‚Ä¢ –°–∫–æ–ø–∏—Ä—É–π –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É: –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ñ–æ—Ä–º–∞—Ç.",

            "–î–µ–Ω—å 7.\n"
            "‚Ä¢ –ê–Ω–∞–ª–∏–∑: —á—Ç–æ –¥–∞—ë—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ö–ü–î? –∫–æ–≥–¥–∞, –≥–¥–µ –∏ –∫–∞–∫ —Ç–µ–±–µ –ª—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è?\n"
            "–§–∏–∫—Å–∏—Ä—É–µ—à—å —ç—Ç–æ –∫–∞–∫ –Ω–æ–≤—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –∞ –Ω–µ —Ä–∞–∑–æ–≤—ã–π –≤—Å–ø–ª–µ—Å–∫."
        ]
    }
}

# ==============================
#     –ó–ê–î–ê–ù–ò–ï –ù–ê –î–ï–ù–¨
# ==============================

def get_task_for_state(user_id: int) -> Optional[str]:
    state = user_state.get(user_id)
    if not state:
        return None

    category = state.get("category")
    style = state.get("style")
    day = state.get("day", 1)

    if category == "custom":
        goal = state.get("goal", "—Ç–≤–æ—è —Ü–µ–ª—å").strip()
        if not goal:
            goal = "—Ç–≤–æ—è —Ü–µ–ª—å"

        soft = [
            f"–î–µ–Ω—å 1.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –µ—ë –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ: –Ω–µ ¬´—Å—Ç–∞—Ç—å –ª—É—á—à–µ¬ª, –∞ ¬´–¥–µ–ª–∞—Ç—å X —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é/–¥–µ–Ω—å¬ª.\n"
            "‚Ä¢ –ù–∞–ø–∏—à–∏, –∑–∞—á–µ–º —Ç–µ–±–µ —ç—Ç–æ (1‚Äì2 —Ñ—Ä–∞–∑—ã). –ë–µ–∑ –≤–æ–¥—ã, –ø–æ-—á–µ—Å—Ç–Ω–æ–º—É.",

            f"–î–µ–Ω—å 2.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –†–∞–∑–±–µ–π –µ—ë –Ω–∞ 5‚Äì10 –º–∞–ª–µ–Ω—å–∫–∏—Ö —à–∞–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞ 10‚Äì30 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ –í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —à–∞–≥ –∏ —Å–¥–µ–ª–∞–π –µ–≥–æ —Å–µ–≥–æ–¥–Ω—è.",

            f"–î–µ–Ω—å 3.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –°–Ω–æ–≤–∞ —Å–¥–µ–ª–∞–π –æ–¥–∏–Ω –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥ –ø–æ —Ü–µ–ª–∏ (10‚Äì20 –º–∏–Ω—É—Ç).\n"
            "‚Ä¢ –ü–µ—Ä–µ–¥ —ç—Ç–∏–º —É–±–µ—Ä–∏ –æ–¥–∏–Ω —Ñ–∞–∫—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ã—á–Ω–æ –º–µ—à–∞–µ—Ç (—Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∏–≤–∞–Ω, —à—É–º –∏ —Ç.–ø.).",

            f"–î–µ–Ω—å 4.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –ü–æ–≤—Ç–æ—Ä–∏ –≤—á–µ—Ä–∞—à–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç, –Ω–æ —á—É—Ç—å —É—Å–∏–ª–∏ —à–∞–≥ (—á—É—Ç—å –¥–æ–ª—å—à–µ –∏–ª–∏ —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ).\n"
            "‚Ä¢ –í –∫–æ–Ω—Ü–µ –∫–æ—Ä–æ—Ç–∫–æ –∑–∞–ø–∏—à–∏: —á—Ç–æ –º–µ—à–∞–ª–æ –∏ —á—Ç–æ –ø–æ–º–æ–≥–ª–æ.",

            f"–î–µ–Ω—å 5.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –î–æ–±–∞–≤—å –≤–æ–∫—Ä—É–≥ —Ü–µ–ª–∏ –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∏—Ç—É–∞–ª.\n"
            "–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–∞—á–∏–Ω–∞–µ—à—å —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –Ω–µ–π –ø–æ—Å–ª–µ –∑–∞–≤—Ç—Ä–∞–∫–∞ –∏–ª–∏ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º.",

            f"–î–µ–Ω—å 6.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –°–¥–µ–ª–∞–π —à–∞–≥ –ø–æ —Ü–µ–ª–∏ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–µ (–¥—Ä—É–≥–∞—è –∫–æ–º–Ω–∞—Ç–∞, –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è, –¥—Ä—É–≥–æ–π –¥–µ–≤–∞–π—Å).\n"
            "–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –º–æ–∑–≥—É –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞—Ç—å –≤ —Å—Ç–∞—Ä–æ–º –ø–∞—Ç—Ç–µ—Ä–Ω–µ.",

            f"–î–µ–Ω—å 7.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –û—Ç–≤–µ—Ç—å —Å–µ–±–µ: —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Å–¥–≤–∏–Ω—É–ª–æ—Å—å –∑–∞ –Ω–µ–¥–µ–ª—é? —á—Ç–æ –æ–∫–∞–∑–∞–ª–æ—Å—å –ø—Ä–æ—â–µ, —á–µ–º —Ç—ã –¥—É–º–∞–ª? —á—Ç–æ —Å–ª–æ–∂–Ω–µ–µ?\n"
            "‚Ä¢ –†–µ—à–∏, –∫–∞–∫–æ–π –æ–¥–∏–Ω –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥ —Ç—ã –≥–æ—Ç–æ–≤ –¥–µ–ª–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–∏–µ 2‚Äì4 –Ω–µ–¥–µ–ª–∏."
        ]

        brutal = [
            f"–î–µ–Ω—å 1.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –§–æ—Ä–º—É–ª–∏—Ä—É–µ—à—å –µ—ë –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á—ë—Ç–∫–æ: —á—Ç–æ –∏–º–µ–Ω–Ω–æ, –≤ –∫–∞–∫–∏—Ö —Ü–∏—Ñ—Ä–∞—Ö/–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è—Ö/—Å—Ä–æ–∫–∞—Ö.\n"
            "‚Ä¢ –ü–∏—à–µ—à—å —Å–µ–±–µ –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç: ¬´–Ø –±–µ—Ä—É –Ω–∞ —Å–µ–±—è –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –¥–µ–ª–∞—Ç—å X —Ä–∞–¥–∏ Y¬ª.",

            f"–î–µ–Ω—å 2.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –í—ã–¥–µ–ª—è–µ—à—å –æ–¥–∏–Ω —à–∞–≥, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–≤–Ω–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–ª, –∏ –¥–µ–ª–∞–µ—à—å –µ–≥–æ —Å–µ–≥–æ–¥–Ω—è –º–∏–Ω–∏–º—É–º 20‚Äì30 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ –î–∞–∂–µ –µ—Å–ª–∏ —Å–¥–µ–ª–∞–µ—à—å –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ ‚Äî –≥–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã –±—ã–ª —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å.",

            f"–î–µ–Ω—å 3.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –£–±–∏—Ä–∞–µ—à—å –æ–¥–∏–Ω –≥–ª–∞–≤–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–µ—à–∞–µ—Ç (—Å–æ—Ü—Å–µ—Ç—å, –∏–≥—Ä–∞, –ø—Ä–∏–≤—ã—á–∫–∞).\n"
            "‚Ä¢ –î–µ–ª–∞–µ—à—å –µ—â—ë –æ–¥–∏–Ω —à–∞–≥ –ø–æ —Ü–µ–ª–∏ (20‚Äì30 –º–∏–Ω—É—Ç —Ñ–æ–∫—É—Å–∞).",

            f"–î–µ–Ω—å 4.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –ë–µ—Ä—ë—à—å —Å–∞–º—É—é –Ω–µ–ø—Ä–∏—è—Ç–Ω—É—é —á–∞—Å—Ç—å —Ü–µ–ª–∏ –∏ —Ä–∞–±–æ—Ç–∞–µ—à—å –∏–º–µ–Ω–Ω–æ —Å –Ω–µ–π —Ö–æ—Ç—è –±—ã 20 –º–∏–Ω—É—Ç.\n"
            "‚Ä¢ –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—à—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç—ã —Å–¥–≤–∏–Ω—É–ª, –Ω–µ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞—è —ç—Ç–æ.",

            f"–î–µ–Ω—å 5.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –°—Ç—Ä–æ–∏—à—å –≤–æ–∫—Ä—É–≥ —Ü–µ–ª–∏ –º–∏–Ω–∏-—Ä–µ–∂–∏–º: –≤—ã–±–∏—Ä–∞–µ—à—å –≤—Ä–µ–º—è –∏ –º–µ—Å—Ç–æ, –≥–¥–µ –±—É–¥–µ—à—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —ç—Ç–∏–º —Å—Ç–∞–±–∏–ª—å–Ω–æ.\n"
            "‚Ä¢ –°–µ–≥–æ–¥–Ω—è –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å —ç—Ç–æ—Ç —Ä–µ–∂–∏–º —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑.",

            f"–î–µ–Ω—å 6.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –ü—Ä–æ–±—É–µ—à—å —É–≤–µ–ª–∏—á–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ 20‚Äì30%: —á—É—Ç—å –¥–æ–ª—å—à–µ, —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, —á—É—Ç—å –º–µ–Ω—å—à–µ –æ—Ç–≤–ª–µ—á–µ–Ω–∏–π.\n"
            "‚Ä¢ –í–µ—á–µ—Ä–æ–º —á–µ—Å—Ç–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—à—å, –ø–æ—Ç—è–Ω—É–ª –ª–∏ —Ç—ã —ç—Ç–æ –∏–ª–∏ –ø–µ—Ä–µ–≥–Ω—É–ª.",

            f"–î–µ–Ω—å 7.\n"
            f"–¶–µ–ª—å: {goal}.\n"
            "‚Ä¢ –î–µ–ª–∞–µ—à—å —Ä–µ–≤–∏–∑–∏—é: —á—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, —á—Ç–æ –Ω–µ—Ç, –∫–∞–∫–∏–µ —à–∞–≥–∏ –¥–∞–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤—ã—Ö–ª–æ–ø.\n"
            "‚Ä¢ –§–æ—Ä–º–∏—Ä—É–µ—à—å –ø—Ä–æ—Å—Ç–æ–π –ø–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü: 1‚Äì2 –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –≥–æ—Ç–æ–≤ –¥–µ–ª–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ."
        ]

        return (soft if style == "soft" else brutal)[day - 1]

    if not category or not style:
        return None

    return plans[category][style][day - 1]


# ==============================
#       PREMIUM –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–ö–ò
# ==============================

def is_premium(user_id: int) -> bool:
    return user_id in premium_enabled


def get_user_style(user_id: int) -> Optional[str]:
    st = user_state.get(user_id)
    if not st:
        return None
    return st.get("style")


def get_premium_today_text(user_id: int, base_task: str, day: int) -> str:
    """
    –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –æ–±—ã—á–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–Ω—ë–º –≤ –±–æ–ª–µ–µ ¬´—É–º–Ω—ã–π¬ª —Ç–µ–∫—Å—Ç,
    —É—á–∏—Ç—ã–≤–∞—è –ø—Ä–µ–º–∏—É–º-–ø—Ä–æ—Ñ–∏–ª—å (–≥—Ä–∞—Ñ–∏–∫ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç).
    –ü–æ–∫–∞ –±–µ–∑ AI, –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ—É—á-—Ç–µ–∫—Å—Ç.
    """
    profile = premium_profile.get(user_id, {})
    wake = profile.get("wake_time", "—É—Ç—Ä–æ")
    sleep = profile.get("sleep_time", "–Ω–æ—á—å")
    work_start = profile.get("work_start", "")
    work_end = profile.get("work_end", "")
    free_time = profile.get("free_time", "")
    train_time = profile.get("train_time", "–≥–∏–±–∫–æ")
    focus = profile.get("focus_priority", "–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞")

    parts = []

    parts.append(f"üìÖ –î–µ–Ω—å {day}/7 ‚Äî –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º.\n")

    # –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–∫—É—â–µ–º—É 7-–¥–Ω–µ–≤–Ω–æ–º—É —Ü–∏–∫–ª—É
    state = user_state.get(user_id, {})
    done_days = state.get("done_days", 0)
    done_days_clamped = max(0, min(done_days, MAX_DAYS))
    percent = int(done_days_clamped / MAX_DAYS * 100)
    progress_bar = build_progress_bar(done_days_clamped, total_days=MAX_DAYS, premium=True)

    parts.append(f"üìä –ü—Ä–æ–≥—Ä–µ—Å—Å —Ü–∏–∫–ª–∞: {done_days_clamped}/{MAX_DAYS} –¥–Ω–µ–π ({percent}%)\n{progress_bar}\n")

    # –£—Ç—Ä–æ
    parts.append(
        f"üåÖ –£—Ç—Ä–æ ({wake}):\n"
        f"‚Äî –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è —á—É—Ç—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–µ–µ, —á–µ–º –≤—á–µ—Ä–∞;\n"
        f"‚Äî 1‚Äì2 –º–∏–Ω—É—Ç—ã –¥—ã—Ö–∞–Ω–∏—è, –≤–æ–¥–∞, –∫–æ—Ä–æ—Ç–∫–∏–π —á–µ–∫-–∏–Ω —Å —Å–æ–±–æ–π.\n"
    )

    # –†–∞–±–æ—Ç–∞/—É—á—ë–±–∞
    if work_start and work_end:
        parts.append(
            f"üíº –†–∞–±–æ—Ç–∞/—É—á—ë–±–∞: {work_start}‚Äì{work_end}.\n"
            f"–í —ç—Ç–æ –≤—Ä–µ–º—è —Ü–µ–ª—å ‚Äî –Ω–µ –≥–µ—Ä–æ–π—Å—Ç–≤–æ, –∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ñ–æ–∫—É—Å."
        )

    # –°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è / —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    if free_time:
        parts.append(f"üïí –°–≤–æ–±–æ–¥–Ω–æ–µ –æ–∫–Ω–æ: {free_time}.\n")
    if train_time == "—É—Ç—Ä–æ":
        parts.append("üèãÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É—é –æ—Å–Ω–æ–≤–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Ç–∞–≤–∏—Ç—å —É—Ç—Ä–æ–º, –ø–æ–∫–∞ –≥–æ–ª–æ–≤–∞ –µ—â—ë —á–∏—Å—Ç–∞—è.")
    elif train_time == "–≤–µ—á–µ—Ä":
        parts.append("üèãÔ∏è –û—Å–Ω–æ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –≤–µ—á–µ—Ä–æ–º, –∫–æ–≥–¥–∞ –±–∞–∑–æ–≤—ã–µ –¥–µ–ª–∞ –∑–∞–∫—Ä—ã—Ç—ã.")
    else:
        parts.append("üèãÔ∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –∏ —É—Ç—Ä–æ–º, –∏ –≤–µ—á–µ—Ä–æ–º ‚Äî –≤—ã–±–µ—Ä–∏, –≥–¥–µ —ç–Ω–µ—Ä–≥–∏—è –≤—ã—à–µ.")

    # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    if focus == "energy":
        parts.append("\n‚ö° –§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏: —ç–Ω–µ—Ä–≥–∏—è. –ù–µ —Ä–µ–∂—å —Å–æ–Ω, –Ω–µ —ç–∫–æ–Ω–æ–º—å –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏.")
    elif focus == "discipline":
        parts.append("\nüß± –§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏: –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞. –ú–µ–Ω—å—à–µ –¥—Ä–∞–º, –±–æ–ª—å—à–µ –º–∞–ª–µ–Ω—å–∫–∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ–±–µ—â–∞–Ω–∏–π.")
    elif focus == "focus":
        parts.append("\nüéØ –§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏: –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è. –ü–æ–º–µ–Ω—å—à–µ –º—É–ª—å—Ç–∏–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏, –ø–æ–±–æ–ª—å—à–µ –∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö —Å–ø—Ä–∏–Ω—Ç–æ–≤.")
    elif focus == "habit":
        parts.append("\nüîÅ –§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏: –ª–æ–º–∫–∞ —Å—Ç–∞—Ä–æ–π –ø—Ä–∏–≤—ã—á–∫–∏. –ú—ã –Ω–µ –∏–¥–µ–∞–ª—å–Ω—ã, –º—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ.")
    else:
        parts.append("\nüìà –§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏: —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –ë–µ–∑ —Ä—ã–≤–∫–æ–≤, –Ω–æ –±–µ–∑ –æ—Ç–∫–∞—Ç–æ–≤.")

    # –û—Å–Ω–æ–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–Ω—è
    parts.append("\nüí° –û—Å–Ω–æ–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–Ω—è:\n" + base_task)

    # –í–µ—á–µ—Ä
    parts.append(
        f"\nüåô –í–µ—á–µ—Ä ({sleep}):\n"
        "‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π —Ä–∞–∑–±–æ—Ä: —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –ø–æ–ª—É—á–∏–ª–æ—Å—å, —á—Ç–æ –ø–æ–º–µ—à–∞–ª–æ;\n"
        "‚Äî –æ–¥–∏–Ω –≤—ã–≤–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±–µ—Ä—ë—à—å —Å —Å–æ–±–æ–π –≤ –∑–∞–≤—Ç—Ä–∞."
    )

    return "\n".join(parts)


# ==============================
#      AI-–ö–û–£–ß (LLM-–û–¢–í–ï–¢)
# ==============================

async def ai_coach_reply(user_id: int, user_message: str) -> Optional[str]:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –æ—Ç AI-–∫–æ—É—á–∞.
    –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á –∏ –µ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
    """
    if not OPENAI_API_KEY or client is None:
        return None

    state = user_state.get(user_id)
    if not state:
        return None

    category = state.get("category")
    style = state.get("style")
    day = state.get("day", 1)

    base_task = get_task_for_state(user_id) or "–°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è, –ø—Ä–æ—Å—Ç–æ –¥–µ—Ä–∂–∏ –∫—É—Ä—Å."

    categories_names = {
        "smoking": "–∫—É—Ä–µ–Ω–∏–µ",
        "masturbation": "–∫–æ–Ω—Ç—Ä–æ–ª—å –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏/–ø–æ—Ä–Ω–æ",
        "procrastination": "–ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è",
        "sport": "—Å–ø–æ—Ä—Ç –∏ —Ç–µ–ª–æ",
        "study": "—É—á—ë–±–∞/—Ä–∞–±–æ—Ç–∞",
        "custom": "–¥—Ä—É–≥–∞—è –ª–∏—á–Ω–∞—è —Ü–µ–ª—å"
    }
    cat_name = categories_names.get(category, "–æ–±—â–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞")

    profile = premium_profile.get(user_id, {})
    wake = profile.get("wake_time")
    sleep = profile.get("sleep_time")
    work_start = profile.get("work_start")
    work_end = profile.get("work_end")
    free_time = profile.get("free_time")
    train_time = profile.get("train_time")
    focus = profile.get("focus_priority")

    style_label = "–º—è–≥–∫–∏–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Å—Ç–∏–ª—å (Soft)" if style == "soft" else "–∂—ë—Å—Ç–∫–∏–π, –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω—ã–π —Å—Ç–∏–ª—å (Brutal)"

    profile_text_parts = []
    if wake:
        profile_text_parts.append(f"- –ø–æ–¥—ä—ë–º: {wake}")
    if sleep:
        profile_text_parts.append(f"- —Å–æ–Ω: {sleep}")
    if work_start or work_end:
        profile_text_parts.append(f"- —Ä–∞–±–æ—Ç–∞/—É—á—ë–±–∞: {work_start or '?'}‚Äì{work_end or '?'}")
    if free_time:
        profile_text_parts.append(f"- —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è: {free_time}")
    if train_time:
        profile_text_parts.append(f"- –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: {train_time}")
    if focus:
        profile_text_parts.append(f"- –≥–ª–∞–≤–Ω—ã–π —Ñ–æ–∫—É—Å —Å–µ–π—á–∞—Å: {focus}")

    profile_block = "\n".join(profile_text_parts) if profile_text_parts else "–Ω–µ—Ç –¥–æ–ø. –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–µ–∂–∏–º—É."

    system_prompt = (
        "–¢—ã ‚Äî LazyKiller Bot, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ—É—á –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ –≤ Telegram.\n"
        "–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ–≥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–µ–Ω—è—Ç—å—Å—è –º–∞–ª–µ–Ω—å–∫–∏–º–∏, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ —à–∞–≥–∞–º–∏.\n\n"
        "–ü—Ä–∞–≤–∏–ª–∞ —Å—Ç–∏–ª—è:\n"
        "1) –û—Ç–≤–µ—á–∞–π –∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É, –º–∞–∫—Å–∏–º—É–º 3‚Äì6 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.\n"
        "2) –ë–µ–∑ –Ω–æ—Ç–∞—Ü–∏–π –∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–∏–∞–≥–Ω–æ–∑–æ–≤.\n"
        "3) –ù–µ –ø–æ–æ—â—Ä—è–π —Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ, –∫—Ä–∞–π–Ω–∏–µ –¥–∏–µ—Ç—ã, –±–µ—Å—Å–æ–Ω–Ω—ã–µ –Ω–æ—á–∏ –∏ –ª—é–±—ã–µ –æ–ø–∞—Å–Ω—ã–µ —à—Ç—É–∫–∏.\n"
        "4) –í Soft-—Ä–µ–∂–∏–º–µ –±—É–¥—å —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–º.\n"
        "5) –í Brutal-—Ä–µ–∂–∏–º–µ –º–æ–∂–Ω–æ –±—ã—Ç—å –ø—Ä—è–º—ã–º –∏ –∂—ë—Å—Ç–∫–∏–º –ø–æ —Å–º—ã—Å–ª—É, –Ω–æ –±–µ–∑ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π –∏ —É–Ω–∏–∂–µ–Ω–∏–π.\n"
        "6) –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–π 1‚Äì2 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è.\n"
        "7) –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –ø–æ —Ç–µ–º–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã/–ø—Ä–∏–≤—ã—á–µ–∫, –æ—Ç–≤–µ—á–∞–π –∫–æ—Ä–æ—Ç–∫–æ –∏ –º—è–≥–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–π –∫ —Ü–µ–ª–∏.\n"
    )

    user_context = (
        f"–¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n"
        f"- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {cat_name}\n"
        f"- –î–µ–Ω—å –ø–ª–∞–Ω–∞: {day} –∏–∑ 7\n"
        f"- –°—Ç–∏–ª—å: {style_label}\n"
        f"- –¢–µ–∫—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–Ω—è:\n{base_task}\n\n"
        f"–ü—Ä–µ–º–∏—É–º –ø—Ä–æ—Ñ–∏–ª—å:\n{profile_block}\n\n"
        f"–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n{user_message}\n\n"
        "–°—Ñ–æ—Ä–º–∏—Ä—É–π –æ—Ç–≤–µ—Ç –∫–∞–∫ –æ—Ç LazyKiller Bot, –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –≤ –∑–∞–¥–∞–Ω–Ω–æ–º —Å—Ç–∏–ª–µ.\n"
        "–ù–µ –ø–æ–≤—Ç–æ—Ä—è–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è, –∞ –æ–ø–∏—Ä–∞–π—Å—è –Ω–∞ –Ω–µ–≥–æ.\n"
        "–î–∞–π —á–µ–ª–æ–≤–µ–∫—É –æ—â—É—â–µ–Ω–∏–µ, —á—Ç–æ –µ–≥–æ —Å–ª—ã—à–∞—Ç, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —Ç–æ–ª–∫–Ω–∏ –∫ –¥–µ–π—Å—Ç–≤–∏—é."
    )

    try:
        resp = await client.chat.completions.create(
            model="gpt-4.1-mini",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": user_context},
            ],
            temperature=0.7,
            max_tokens=300,
        )
        answer = resp.choices[0].message.content.strip()
        return answer
    except Exception as e:
        print("AI error:", e)
        return None


# ==============================
#            HANDLERS
# ==============================

async def start_handler(message: types.Message):
    user_id = message.from_user.id
    user_state.pop(user_id, None)
    waiting_for_custom_goal.discard(user_id)
    premium_setup_stage.pop(user_id, None)
    save_data()

    await message.answer(
        "üî• –ü—Ä–∏–≤–µ—Ç! –Ø LazyKiller Bot.\n\n"
        "–Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Å—Ç–∞—Ç—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–µ–µ ‚Äî –º—è–≥–∫–æ –∏–ª–∏ –∂—ë—Å—Ç–∫–æ.\n"
        "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –ø—Ä–æ–±–ª–µ–º—É, –ø–æ—Ç–æ–º —Å—Ç–∏–ª—å.\n\n"
        "–ö–æ–º–∞–Ω–¥—ã:\n"
        "/problem ‚Äî –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å\n"
        "/today ‚Äî –∑–∞–¥–∞–Ω–∏–µ –¥–Ω—è\n"
        "/done ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ\n"
        "/status ‚Äî —Ç–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å\n"
        "/premium ‚Äî –ø—Ä–æ –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º\n"
        "/remind ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞–Ω–∏–∏\n"
        "/help ‚Äî –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º\n"
        "/reset ‚Äî –Ω–∞—á–∞—Ç—å –≤—Å—ë –∑–∞–Ω–æ–≤–æ\n",
        reply_markup=main_kb
    )


async def problem_handler(message: types.Message):
    user_id = message.from_user.id
    user_state.pop(user_id, None)
    waiting_for_custom_goal.discard(user_id)
    premium_setup_stage.pop(user_id, None)
    save_data()

    await message.answer(
        "–í—ã–±–µ—Ä–∏, –Ω–∞–¥ —á–µ–º —Ä–∞–±–æ—Ç–∞–µ–º:",
        reply_markup=main_kb
    )


async def today_handler(message: types.Message):
    uid = message.from_user.id
    state = user_state.get(uid)

    if not state:
        await message.answer("–ü–ª–∞–Ω –Ω–µ –≤—ã–±—Ä–∞–Ω. –ù–∞–∂–º–∏ /problem.")
        return

    if not state.get("style"):
        await message.answer("–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:", reply_markup=style_kb)
        return

    day = state["day"]
    base_task = get_task_for_state(uid)
    if not base_task:
        await message.answer("–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ —Å –ø–ª–∞–Ω–æ–º. –ù–∞–∂–º–∏ /problem –∏ –Ω–∞—á–Ω–∏ –∑–∞–Ω–æ–≤–æ.")
        return

    if is_premium(uid) and uid in premium_profile:
        text = get_premium_today_text(uid, base_task, day)
        await message.answer(text)
    else:
        await message.answer(f"üìÖ –î–µ–Ω—å {day}/7\n\n{base_task}")


async def done_handler(message: types.Message):
    uid = message.from_user.id
    state = user_state.get(uid)

    if not state:
        await message.answer("–£ —Ç–µ–±—è –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞. –ù–∞–∂–º–∏ /problem.")
        return

    current_day = state.get("day", 1)
    last_done = state.get("last_done_day", 0)

    if current_day > MAX_DAYS:
        await message.answer("–¢—ã —É–∂–µ –ø—Ä–æ—à—ë–ª –≤—Å–µ 7 –¥–Ω–µ–π. –ù–∞–∂–º–∏ /problem, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª.")
        return

    if last_done == current_day:
        await message.answer(
            f"–î–µ–Ω—å {current_day} —É–∂–µ –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π.\n"
            "–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —á–µ—Ä–µ–∑ /status."
        )
        return

    state["done_days"] = state.get("done_days", 0) + 1
    state["last_done_day"] = current_day
    state["day"] = current_day + 1
    save_data()

    if state["day"] > MAX_DAYS:
        await message.answer("üî• –¢—ã –ø—Ä–æ—à—ë–ª –≤—Å–µ 7 –¥–Ω–µ–π! –•–æ—á–µ—à—å –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥? –ù–∞–∂–º–∏ /problem.")
        return

    await message.answer(
        f"–ì–æ—Ç–æ–≤–æ! –ó–∞–≤—Ç—Ä–∞ –î–µ–Ω—å {state['day']}.\n–ù–∞–ø–æ–º–Ω—é —á–µ—Ä–µ–∑ /today."
    )


async def status_handler(message: types.Message):
    uid = message.from_user.id
    st = user_state.get(uid)

    if not st:
        await message.answer("–°—Ç–∞—Ç—É—Å –ø—É—Å—Ç. –ù–∞—á–Ω–∏ —Å /problem.")
        return

    categories_names = {
        "smoking": "üö≠ –ö—É—Ä–µ–Ω–∏–µ",
        "masturbation": "üôà –ú–∞—Å—Ç—É—Ä–±–∞—Ü–∏—è",
        "procrastination": "üò¥ –ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è",
        "sport": "üèãÔ∏è –°–ø–æ—Ä—Ç",
        "study": "üìö –£—á—ë–±–∞/—Ä–∞–±–æ—Ç–∞",
        "custom": "üéØ –î—Ä—É–≥–∞—è —Ü–µ–ª—å"
    }

    cat = categories_names.get(st.get("category"), "–Ω–µ –≤—ã–±—Ä–∞–Ω–æ")
    style = st.get("style")
    style_name = "üòå Soft" if style == "soft" else "üî• Brutal" if style == "brutal" else "–Ω–µ –≤—ã–±—Ä–∞–Ω"

    premium_flag = "–∞–∫—Ç–∏–≤–µ–Ω" if is_premium(uid) else "–Ω–µ –∞–∫—Ç–∏–≤–µ–Ω"

    text = (
        f"üìä –¢–≤–æ–π —Å—Ç–∞—Ç—É—Å:\n\n"
        f"–¶–µ–ª—å: {cat}\n"
        f"–°—Ç–∏–ª—å: {style_name}\n"
        f"–î–µ–Ω—å: {st.get('day',1)}/7\n"
        f"Premium: {premium_flag}\n"
    )

    done_days = st.get("done_days", 0)
    done_days_clamped = max(0, min(done_days, MAX_DAYS))
    percent = int(done_days_clamped / MAX_DAYS * 100)
    bar = build_progress_bar(done_days_clamped, total_days=MAX_DAYS, premium=is_premium(uid))

    text += (
        f"\n‚úÖ –ó–∞–∫—Ä—ã—Ç–æ –¥–Ω–µ–π: {done_days_clamped} –∏–∑ {MAX_DAYS} ({percent}%)\n"
        f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {bar}\n"
    )

    if uid in premium_profile:
        prof = premium_profile[uid]
        text += (
            "\nüß© Premium-–ø—Ä–æ—Ñ–∏–ª—å:\n"
            f"- –ü–æ–¥—ä—ë–º: {prof.get('wake_time', '–Ω–µ –∑–∞–¥–∞–Ω')}\n"
            f"- –°–æ–Ω: {prof.get('sleep_time', '–Ω–µ –∑–∞–¥–∞–Ω')}\n"
            f"- –†–∞–±–æ—Ç–∞/—É—á—ë–±–∞: {prof.get('work_start','?')}‚Äì{prof.get('work_end','?')}\n"
            f"- –°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è: {prof.get('free_time', '–Ω–µ –∑–∞–¥–∞–Ω–æ')}\n"
            f"- –í—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: {prof.get('train_time', '–Ω–µ –∑–∞–¥–∞–Ω–æ')}\n"
            f"- –§–æ–∫—É—Å: {prof.get('focus_priority', '–Ω–µ –∑–∞–¥–∞–Ω')}\n"
        )

    await message.answer(text)


# ==============================
#        HELP & RESET
# ==============================

async def help_handler(message: types.Message):
    await message.answer(
        "üõ† LazyKillerBot ‚Äî –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:\n\n"
        "üîπ –ö–∞–∫ –Ω–∞—á–∞—Ç—å:\n"
        "1. –ù–∞–∂–º–∏ /problem\n"
        "2. –í—ã–±–µ—Ä–∏ —Ü–µ–ª—å\n"
        "3. –í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å: üòå Soft –∏–ª–∏ üî• Brutal\n"
        "4. –ü–æ–ª—É—á–∞–π –∑–∞–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ /today\n\n"
        "üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
        "/problem ‚Äî –≤—ã–±—Ä–∞—Ç—å –∏–ª–∏ —Å–º–µ–Ω–∏—Ç—å —Ü–µ–ª—å\n"
        "/today ‚Äî –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n"
        "/done ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ\n"
        "/status ‚Äî —Ç–≤–æ–π —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å\n"
        "/remind ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –±—É–¥–Ω–∏)\n"
        "/reset ‚Äî –Ω–∞—á–∞—Ç—å —Ü–∏–∫–ª –∑–∞–Ω–æ–≤–æ\n"
        "/premium ‚Äî –≤—Å—ë –ø—Ä–æ Premium\n\n"
        "üîπ –†–µ–∂–∏–º—ã:\n"
        "üòå Soft ‚Äî –º—è–≥–∫–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ\n"
        "üî• Brutal ‚Äî –∂—ë—Å—Ç–∫–æ –∏ –ø—Ä—è–º–æ\n\n"
        "üîπ Premium –¥–∞—ë—Ç:\n"
        "‚Ä¢ AI-–∫–æ—É—á\n"
        "‚Ä¢ –ó–∞–¥–∞–Ω–∏—è –ø–æ–¥ —Ç–≤–æ–π —Ä–µ–∂–∏–º –¥–Ω—è\n"
        "‚Ä¢ –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n"
        "‚Ä¢ –£–º–Ω—ã–µ —Å–æ–≤–µ—Ç—ã\n\n"
        "–ü—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏ —Å /problem –∏ —Å–¥–µ–ª–∞–π –ø–µ—Ä–≤—ã–π —à–∞–≥."
    )


async def reset_handler(message: types.Message):
    uid = message.from_user.id

    user_state.pop(uid, None)
    waiting_for_custom_goal.discard(uid)
    premium_setup_stage.pop(uid, None)
    save_data()

    await message.answer(
        "üîÑ –í—Å—ë —Å–±—Ä–æ—à–µ–Ω–æ.\n\n"
        "–¢—ã –º–æ–∂–µ—à—å –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞.\n"
        "–ù–∞–∂–º–∏ /problem –∏ –≤—ã–±–µ—Ä–∏ –Ω–æ–≤—É—é —Ü–µ–ª—å.",
        reply_markup=main_kb
    )


# ==============================
#        PREMIUM HANDLERS
# ==============================

async def premium_handler(message: types.Message):
    uid = message.from_user.id
    if is_premium(uid):
        text = (
            "üåü –£ —Ç–µ–±—è —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω LazyKiller Premium (–¥–µ–º–æ-—Ä–µ–∂–∏–º –±–µ–∑ –æ–ø–ª–∞—Ç—ã).\n\n"
            "–¢—ã –ø–æ–ª—É—á–∞–µ—à—å:\n"
            "‚Ä¢ –£–º–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–Ω—è —Å —É—á—ë—Ç–æ–º —Ç–≤–æ–µ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞\n"
            "‚Ä¢ –ì–∏–±—Ä–∏–¥–Ω—ã–π –∫–æ—É—á-—Å—Ç–∏–ª—å (Zen + High-Performance)\n"
            "‚Ä¢ –ê–Ω–∫–µ—Ç—É –ø–æ–¥ —Ç–≤–æ–π —Ä–µ–∂–∏–º –¥–Ω—è\n\n"
            "–ö–æ–º–∞–Ω–¥—ã:\n"
            "/premium_profile ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É\n"
            "/today ‚Äî –∑–∞–¥–∞–Ω–∏–µ –¥–Ω—è –≤ –ø—Ä–µ–º–∏—É–º-—Ñ–æ—Ä–º–∞—Ç–µ\n"
        )
    else:
        text = (
            "üåü LazyKiller Premium\n\n"
            "Premium –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–∞—ë—Ç –∑–∞–¥–∞–Ω–∏—è ‚Äî –æ–Ω –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —Ç–≤–æ–π –≥—Ä–∞—Ñ–∏–∫, —ç–Ω–µ—Ä–≥–∏—é –∏ —Ü–µ–ª–∏.\n\n"
            "–ß—Ç–æ –±—É–¥–µ—Ç –≤ –ø–æ–ª–Ω–æ–º –ø—Ä–µ–º–∏—É–º–µ:\n"
            "‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–Ω–µ–≤–Ω–æ–π –ø–ª–∞–Ω –ø–æ–¥ —Ç–≤–æ–π —Ä–µ–∂–∏–º –¥–Ω—è\n"
            "‚Ä¢ –ì–∏–±—Ä–∏–¥–Ω—ã–π Zen-–∫–æ—É—á (–º—è–≥–∫–æ, –Ω–æ –ø—Ä—è–º–æ –ø–æ –¥–µ–ª—É)\n"
            "‚Ä¢ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã (14 –∏ 30 –¥–Ω–µ–π)\n"
            "‚Ä¢ –†–µ–∞–∫—Ü–∏—è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: ¬´—É—Å—Ç–∞–ª¬ª, ¬´—Å–æ—Ä–≤–∞–ª—Å—è¬ª, ¬´–Ω–µ –º–æ–≥—É¬ª\n"
            "‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è, –∞ –Ω–µ —Ä–∞–Ω–¥–æ–º–Ω–æ\n"
            "‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –¥–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n\n"
            "–°–µ–π—á–∞—Å –≤–∫–ª—é—á–µ–Ω –¥–µ–º–æ-—Ä–µ–∂–∏–º, –±–µ–∑ –æ–ø–ª–∞—Ç—ã.\n"
            "–•–æ—á–µ—à—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ç—å ‚Äî –Ω–∞–ø–∏—à–∏ /premium_demo."
        )
    await message.answer(text)


async def premium_demo_handler(message: types.Message):
    uid = message.from_user.id
    premium_enabled.add(uid)
    save_data()

    await message.answer(
        "‚úÖ –î–µ–º–æ-Premium –≤–∫–ª—é—á—ë–Ω.\n\n"
        "–°–µ–π—á–∞—Å —è –∑–∞–¥–∞–º –ø–∞—Ä—É –≤–æ–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –ø–æ–¥—Å—Ç—Ä–æ–∏—Ç—å—Å—è –ø–æ–¥ —Ç–≤–æ–π —Ä–µ–∂–∏–º.\n"
        "–ú–æ–∂–µ—à—å –æ—Ç–≤–µ—á–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—É–ø–µ—Ä —Ç–æ—á–Ω–æ."
    )
    await start_premium_setup(message)


async def premium_profile_handler(message: types.Message):
    uid = message.from_user.id
    if uid not in premium_profile:
        await message.answer(
            "–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–º–∏—É–º-–∞–Ω–∫–µ—Ç—ã.\n"
            "–î–∞–≤–∞–π –∑–∞–ø–æ–ª–Ω–∏–º –µ—ë.\n"
            "–ù–∞–∂–º–∏ /premium_demo –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏: ¬´–∑–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É¬ª."
        )
        return

    prof = premium_profile[uid]
    text = (
        "üß© –¢–≤–æ–π –ø—Ä–µ–º–∏—É–º-–ø—Ä–æ—Ñ–∏–ª—å:\n\n"
        f"- –ü–æ–¥—ä—ë–º: {prof.get('wake_time', '–Ω–µ –∑–∞–¥–∞–Ω')}\n"
        f"- –°–æ–Ω: {prof.get('sleep_time', '–Ω–µ –∑–∞–¥–∞–Ω')}\n"
        f"- –†–∞–±–æ—Ç–∞/—É—á—ë–±–∞: {prof.get('work_start','?')}‚Äì{prof.get('work_end','?')}\n"
        f"- –°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è: {prof.get('free_time', '–Ω–µ –∑–∞–¥–∞–Ω–æ')}\n"
        f"- –í—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: {prof.get('train_time', '–Ω–µ –∑–∞–¥–∞–Ω–æ')}\n"
        f"- –§–æ–∫—É—Å: {prof.get('focus_priority', '–Ω–µ –∑–∞–¥–∞–Ω')}\n\n"
        "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å ‚Äî –Ω–∞–ø–∏—à–∏: ¬´–æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É¬ª."
    )
    await message.answer(text)


# ==============================
#      PREMIUM –ê–ù–ö–ï–¢–ê
# ==============================

async def start_premium_setup(message: types.Message):
    uid = message.from_user.id
    premium_profile[uid] = {}
    premium_setup_stage[uid] = 1
    save_data()
    await message.answer("1/6. –í–æ —Å–∫–æ–ª—å–∫–æ —Ç—ã –æ–±—ã—á–Ω–æ –ø—Ä–æ—Å—ã–ø–∞–µ—à—å—Å—è? (–ù–∞–ø—Ä–∏–º–µ—Ä: 07:30)")


async def handle_premium_setup(message: types.Message):
    uid = message.from_user.id
    text = (message.text or "").strip()
    stage = premium_setup_stage.get(uid, 0)

    if stage == 1:
        premium_profile.setdefault(uid, {})["wake_time"] = text
        premium_setup_stage[uid] = 2
        save_data()
        await message.answer("2/6. –í–æ —Å–∫–æ–ª—å–∫–æ –æ–±—ã—á–Ω–æ –ª–æ–∂–∏—à—å—Å—è —Å–ø–∞—Ç—å? (–ù–∞–ø—Ä–∏–º–µ—Ä: 23:30)")
        return

    if stage == 2:
        premium_profile[uid]["sleep_time"] = text
        premium_setup_stage[uid] = 3
        save_data()
        await message.answer(
            "3/6. –£ —Ç–µ–±—è –µ—Å—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏–ª–∏ —É—á—ë–±–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏? "
            "–ï—Å–ª–∏ –¥–∞ ‚Äî –Ω–∞–ø–∏—à–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä: 10:00‚Äì18:00. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –Ω–∞–ø–∏—à–∏ ¬´–Ω–µ—Ç¬ª."
        )
        return

    if stage == 3:
        if text.lower() == "–Ω–µ—Ç":
            premium_profile[uid]["work_start"] = ""
            premium_profile[uid]["work_end"] = ""
        else:
            parts = text.replace(" ", "").split("‚Äì")
            if len(parts) == 2:
                premium_profile[uid]["work_start"] = parts[0]
                premium_profile[uid]["work_end"] = parts[1]
            else:
                premium_profile[uid]["work_start"] = text
                premium_profile[uid]["work_end"] = ""
        premium_setup_stage[uid] = 4
        save_data()
        await message.answer(
            "4/6. –í –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —É —Ç–µ–±—è –æ–±—ã—á–Ω–æ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–µ–±—è? "
            "–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´—É—Ç—Ä–æ–º –¥–æ —Ä–∞–±–æ—Ç—ã¬ª, ¬´–ø–æ—Å–ª–µ 20:00¬ª, ¬´–ø–æ –≤–µ—á–µ—Ä–∞–º¬ª."
        )
        return

    if stage == 4:
        premium_profile[uid]["free_time"] = text
        premium_setup_stage[uid] = 5
        save_data()
        await message.answer(
            "5/6. –í –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —Ç–µ–±–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–µ–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–æ–±–æ–π?\n"
            "–ù–∞–ø–∏—à–∏: ¬´—É—Ç—Ä–æ¬ª, ¬´–≤–µ—á–µ—Ä¬ª –∏–ª–∏ ¬´–≥–∏–±–∫–æ¬ª."
        )
        return

    if stage == 5:
        t = text.lower()
        if "—É—Ç—Ä–æ" in t:
            premium_profile[uid]["train_time"] = "—É—Ç—Ä–æ"
        elif "–≤–µ—á" in t:
            premium_profile[uid]["train_time"] = "–≤–µ—á–µ—Ä"
        else:
            premium_profile[uid]["train_time"] = "–≥–∏–±–∫–æ"
        premium_setup_stage[uid] = 6
        save_data()
        await message.answer(
            "6/6. –ß—Ç–æ –¥–ª—è —Ç–µ–±—è –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ —Å–µ–π—á–∞—Å?\n"
            "–ù–∞–ø–∏—à–∏ –æ–¥–Ω–æ —Å–ª–æ–≤–æ: ¬´—ç–Ω–µ—Ä–≥–∏—è¬ª, ¬´–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞¬ª, ¬´—Ñ–æ–∫—É—Å¬ª, ¬´–ø—Ä–∏–≤—ã—á–∫–∞¬ª –∏–ª–∏ ¬´—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å¬ª."
        )
        return

    if stage == 6:
        t = text.lower()
        if "—ç–Ω–µ—Ä–≥" in t:
            premium_profile[uid]["focus_priority"] = "energy"
        elif "–¥–∏—Å—Ü" in t:
            premium_profile[uid]["focus_priority"] = "discipline"
        elif "—Ñ–æ–∫—É—Å" in t or "–∫–æ–Ω—Ü–µ–Ω—Ç" in t:
            premium_profile[uid]["focus_priority"] = "focus"
        elif "–ø—Ä–∏–≤—ã—á" in t:
            premium_profile[uid]["focus_priority"] = "habit"
        else:
            premium_profile[uid]["focus_priority"] = "stable"

        premium_setup_stage.pop(uid, None)
        save_data()
        await message.answer(
            "–ì–æ—Ç–æ–≤–æ. –Ø –ø–æ–¥—Å—Ç—Ä–æ–∏–ª—Å—è –ø–æ–¥ —Ç–≤–æ–π —Ä–µ–∂–∏–º.\n\n"
            "–¢–µ–ø–µ—Ä—å /today –±—É–¥–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ —Å —É—á—ë—Ç–æ–º —Ç–≤–æ–µ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.\n"
            "–ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∞–Ω–∫–µ—Ç—É ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏: ¬´–æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É¬ª."
        )
        return


# ==============================
#      –ú–ò–ù–ò-–î–ò–ê–õ–û–ì + AI
# ==============================

async def text_router(message: types.Message):
    uid = message.from_user.id
    raw_text = message.text or ""
    text = raw_text.lower().strip()

    # –ï—Å–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–µ–º–∏—É–º-–∞–Ω–∫–µ—Ç—ã
    if uid in premium_setup_stage:
        await handle_premium_setup(message)
        return

    # –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ü–µ–ª—å
    if uid in waiting_for_custom_goal:
        waiting_for_custom_goal.discard(uid)
        user_state[uid] = {
            "category": "custom",
            "goal": raw_text.strip(),
            "style": None,
            "day": 1,
            "done_days": 0,
            "last_done_day": 0,
        }
        save_data()
        await message.answer(
            "–¶–µ–ª—å –ø—Ä–∏–Ω—è—Ç–∞ ‚úÖ –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:",
            reply_markup=style_kb
        )
        return

    style = get_user_style(uid)
    is_brutal = (style == "brutal")

    # –í—ã–±–æ—Ä —Å—Ç–∏–ª—è
    if "soft" in text or "üòå" in text:
        st = user_state.get(uid)
        if not st:
            await message.answer("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Ü–µ–ª—å —á–µ—Ä–µ–∑ /problem.")
            return
        st["style"] = "soft"
        st["day"] = st.get("day", 1)
        save_data()
        task = get_task_for_state(uid)
        await message.answer(f"üòå Soft –≤—ã–±—Ä–∞–Ω.\n\nüìÖ –î–µ–Ω—å {st['day']}/7\n{task}")
        return

    if "brutal" in text or "üî•" in text:
        st = user_state.get(uid)
        if not st:
            await message.answer("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Ü–µ–ª—å —á–µ—Ä–µ–∑ /problem.")
            return
        st["style"] = "brutal"
        st["day"] = st.get("day", 1)
        save_data()
        task = get_task_for_state(uid)
        await message.answer(f"üî• Brutal –≤—ã–±—Ä–∞–Ω.\n\nüìÖ –î–µ–Ω—å {st['day']}/7\n{task}")
        return

    # –¢—Ä–∏–≥–≥–µ—Ä—ã —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
    if any(w in text for w in ["—Ç—è–∂–µ–ª–æ", "—Å–ª–æ–∂–Ω–æ", "–Ω–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏", "–Ω–µ—Ç —Å–∏–ª—ã", "–Ω–µ—Ç —Å–∏–ª", "—É—Å—Ç–∞–ª", "–Ω–µ —Ö–æ—á—É"]):
        if is_brutal:
            await message.answer(
                "–¢—è–∂–µ–ª–æ ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –í–æ–ø—Ä–æ—Å –Ω–µ –≤ —Ç–æ–º, –ª–µ–≥–∫–æ –ª–∏ —Ç–µ–±–µ, –∞ –≤ —Ç–æ–º, –¥–µ–ª–∞–µ—à—å —Ç—ã —à–∞–≥ –∏–ª–∏ –Ω–µ—Ç.\n"
                "–°–¥–µ–ª–∞–π —Ö–æ—Ç—è –±—ã –º–∞–ª–µ–Ω—å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏ –ø–æ—Ç–æ–º —É–∂–µ –æ–±—Å—É–∂–¥–∞–π, —á—Ç–æ ¬´–Ω–µ –º–æ–∂–µ—à—å¬ª."
            )
        else:
            await message.answer(
                "–¢–∞–∫ –±—ã–≤–∞–µ—Ç. –¢—ã –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫, –∞ –Ω–µ —Ä–æ–±–æ—Ç.\n"
                "–°–¥–µ–ª–∞–π –º–∏–∫—Ä–æ-—à–∞–≥ –Ω–∞ 5‚Äì10 –º–∏–Ω—É—Ç ‚Äî —ç—Ç–æ–≥–æ —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –¥–µ–Ω—å –Ω–µ –±—ã–ª —Å–ª–∏—Ç."
            )
        return

    if any(w in text for w in ["—Å–æ—Ä–≤–∞–ª", "—Å–æ—Ä–≤–∞–ª—Å—è", "—Å–¥–∞–ª—Å—è", "—Å–ª–∏–ª—Å—è", "–Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å", "–æ–ø—è—Ç—å —Å–¥–µ–ª–∞–ª"]):
        if is_brutal:
            await message.answer(
                "–û–∫–µ–π, —Å–æ—Ä–≤–∞–ª—Å—è. –ù–µ –ø–µ—Ä–≤—ã–π –∏ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑.\n"
                "–í–æ–ø—Ä–æ—Å: —Ç—ã –¥–µ–ª–∞–µ—à—å –≤—ã–≤–æ–¥—ã –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∂–∞–ª–µ–µ—à—å —Å–µ–±—è?\n"
                "–°–¥–µ–ª–∞–π —Å–µ–≥–æ–¥–Ω—è —Ö–æ—Ç—è –±—ã –ø–æ–ª–æ–≤–∏–Ω—É –∑–∞–¥–∞–Ω–∏—è ‚Äî –∏ –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–π –æ–¥–∏–Ω —Å—Ä—ã–≤ –≤ –Ω–µ–¥–µ–ª—é —Å–ª–∏–≤–∞."
            )
        else:
            await message.answer(
                "–°—Ä—ã–≤ ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞, –∞ –Ω–µ –ø—Ä–∏–≥–æ–≤–æ—Ä.\n"
                "–ü–æ–ø—Ä–æ–±—É–π —Å–µ–π—á–∞—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É–ø—Ä–æ—â—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –∑–∞–¥–∞–Ω–∏—è –∏ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ, –∞ –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞—Ç—å."
            )
        return

    if any(w in text for w in ["—Å–¥–µ–ª–∞–ª", "—Å–¥–µ–ª–∞–ª –≤—Å–µ", "–≤—ã–ø–æ–ª–Ω–∏–ª", "–ø–æ–ª—É—á–∏–ª–æ—Å—å", "–≥–æ—Ä–∂—É—Å—å"]):
        if is_brutal:
            await message.answer(
                "–ù–æ—Ä–º–∞–ª—å–Ω–æ. –¢–∞–∫ –∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å.\n"
                "–û—Ç–º–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —á–µ—Ä–µ–∑ /done –∏ –≥–æ—Ç–æ–≤—å—Å—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É."
            )
        else:
            await message.answer(
                "–ö—Ä–∞—Å–∞–≤–∞, —Ä–µ–∞–ª—å–Ω–æ.\n"
                "–û—Ç–º–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —á–µ—Ä–µ–∑ /done –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π –≤–Ω—É—Ç—Ä–∏, —á—Ç–æ —Ç—ã —Å–ø–æ—Å–æ–±–µ–Ω –¥–µ—Ä–∂–∞—Ç—å —Å–ª–æ–≤–æ."
            )
        return

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ—Ä–∞–∑ –¥–ª—è –ø—Ä–µ–º–∏—É–º-–∞–Ω–∫–µ—Ç—ã
    if "–æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É" in text or "–∑–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É" in text:
        if not is_premium(uid):
            await message.answer("–ê–Ω–∫–µ—Ç–∞ ‚Äî —á–∞—Å—Ç—å –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º–∞. –í–∫–ª—é—á–∏ –¥–µ–º–æ —á–µ—Ä–µ–∑ /premium_demo.")
        else:
            await start_premium_setup(message)
        return

    # today/done —Ç–µ–∫—Å—Ç–æ–º
    if text == "—Å–µ–≥–æ–¥–Ω—è":
        await today_handler(message)
        return

    if text == "—Å–¥–µ–ª–∞–ª":
        await done_handler(message)
        return

    # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
    if "–∫—É—Ä" in text or "üö≠" in text:
        user_state[uid] = {
            "category": "smoking",
            "style": None,
            "day": 1,
            "done_days": 0,
            "last_done_day": 0,
        }
        save_data()
        await message.answer("–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:", reply_markup=style_kb)
        return

    if "–º–∞—Å—Ç—É—Ä" in text or "üôà" in text:
        user_state[uid] = {
            "category": "masturbation",
            "style": None,
            "day": 1,
            "done_days": 0,
            "last_done_day": 0,
        }
        save_data()
        await message.answer("–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:", reply_markup=style_kb)
        return

    if "–ø—Ä–æ–∫—Ä–∞—Å—Ç" in text or "üò¥" in text:
        user_state[uid] = {
            "category": "procrastination",
            "style": None,
            "day": 1,
            "done_days": 0,
            "last_done_day": 0,
        }
        save_data()
        await message.answer("–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:", reply_markup=style_kb)
        return

    if "—Å–ø–æ—Ä—Ç" in text or "üèã" in text:
        user_state[uid] = {
            "category": "sport",
            "style": None,
            "day": 1,
            "done_days": 0,
            "last_done_day": 0,
        }
        save_data()
        await message.answer("–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:", reply_markup=style_kb)
        return

    if "—É—á" in text or "—Ä–∞–±–æ—Ç" in text or "üìö" in text:
        user_state[uid] = {
            "category": "study",
            "style": None,
            "day": 1,
            "done_days": 0,
            "last_done_day": 0,
        }
        save_data()
        await message.answer("–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:", reply_markup=style_kb)
        return

    if "–¥—Ä—É–≥" in text or "—Ü–µ–ª—å" in text or "üéØ" in text:
        waiting_for_custom_goal.add(uid)
        await message.answer("–ù–∞–ø–∏—à–∏ —Å–≤–æ—é —Ü–µ–ª—å –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º.")
        return

    # ==== AI-–¥–æ–≥—Ä—É–∑–∫–∞ –¥–ª—è –ø—Ä–µ–º–∏—É–º-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ====
    if is_premium(uid) and style:
        ai_answer = await ai_coach_reply(uid, raw_text)
        if ai_answer:
            await message.answer(ai_answer)
            return

    # –ï—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ –ø–æ–Ω—è–ª
    await message.answer(
        "–Ø –Ω–µ –ø–æ–Ω—è–ª. –ò—Å–ø–æ–ª—å–∑—É–π /problem, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å, –∏–ª–∏ /today, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ.\n"
        "–ü—Ä–æ –ø—Ä–µ–º–∏—É–º –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ /premium."
    )


# ==============================
#      –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–Ø /remind
# ==============================

async def remind_handler(message: types.Message):
    uid = message.from_user.id
    text = (message.text or "").strip()
    parts = text.split()

    # /remind –∏–ª–∏ /remind –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
    if len(parts) == 1:
        await message.answer(
            "–ù–∞–ø–∏—à–∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã.\n\n"
            "–ü—Ä–∏–º–µ—Ä—ã:\n"
            "‚Ä¢ /remind 10:00 ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00\n"
            "‚Ä¢ /remind 21:30 ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 21:30\n"
            "‚Ä¢ /remind 12:00 –±—É–¥–Ω–∏ ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –±—É–¥–Ω–∏–µ –¥–Ω–∏\n"
            "‚Ä¢ /remind off ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è"
        )
        return

    arg = parts[1].lower()

    # –≤—ã–∫–ª—é—á–µ–Ω–∏–µ
    if arg in ["off", "–≤—ã–∫–ª", "–Ω–µ—Ç"]:
        if uid in reminders:
            reminders.pop(uid, None)
            save_data()
            await message.answer("–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω—ã ‚úÖ")
        else:
            await message.answer("–£ —Ç–µ–±—è –∏ —Ç–∞–∫ –Ω–µ –±—ã–ª–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.")
        return

    # –∏—â–µ–º —Ç–æ–∫–µ–Ω —Å –≤—Ä–µ–º–µ–Ω–µ–º —Ñ–æ—Ä–º–∞—Ç–∞ –ß–ß:–ú–ú
    time_token = None
    for p in parts[1:]:
        if ":" in p:
            time_token = p
            break

    if not time_token:
        await message.answer("–ù–∞–ø–∏—à–∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú, –Ω–∞–ø—Ä–∏–º–µ—Ä: /remind 09:30 –∏–ª–∏ /remind 21:00")
        return

    try:
        hh, mm = time_token.split(":")
        hh = int(hh)
        mm = int(mm)
        if not (0 <= hh < 24 and 0 <= mm < 60):
            raise ValueError
    except Exception:
        await message.answer("–ù–∞–ø–∏—à–∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú, –Ω–∞–ø—Ä–∏–º–µ—Ä: /remind 09:30 –∏–ª–∏ /remind 21:00")
        return

    # —Ä–µ–∂–∏–º: daily –∏–ª–∏ weekdays
    rest_text = " ".join(parts[2:]).lower()
    if "–±—É–¥–Ω" in rest_text:
        mode = "weekdays"
    else:
        mode = "daily"

    reminders[uid] = {
        "time": f"{hh:02d}:{mm:02d}",
        "mode": mode,
    }
    save_data()

    if mode == "weekdays":
        await message.answer(
            f"–û–∫–µ–π. –ë—É–¥—É –ø–∏–Ω–≥–æ–≤–∞—Ç—å —Ç–µ–±—è –ø–æ –±—É–¥–Ω—è–º (–ø–Ω‚Äì–ø—Ç) –≤ {hh:02d}:{mm:02d} –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–µ—Ä–≤–µ—Ä–∞ ‚è∞"
        )
    else:
        await message.answer(
            f"–û–∫–µ–π. –ë—É–¥—É –ø–∏–Ω–≥–æ–≤–∞—Ç—å —Ç–µ–±—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ {hh:02d}:{mm:02d} –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–µ—Ä–≤–µ—Ä–∞ ‚è∞"
        )


# ==============================
#    –§–û–ù–û–í–´–ô –í–û–†–ö–ï–† –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ô
# ==============================

async def reminder_worker(bot: Bot):
    """
    –§–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä: —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É —Å–º–æ—Ç—Ä–∏—Ç, –∫–æ–º—É –ø–æ—Ä–∞ —Å–ª–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è (datetime.now()).
    """
    already_notified = set()  # (user_id, date_str)

    while True:
        try:
            now = datetime.now()
            current_time = now.strftime("%H:%M")
            current_date = now.strftime("%Y-%m-%d")

            # —á–∏—Å—Ç–∏–º –∫—ç—à "—É–∂–µ —É–≤–µ–¥–æ–º–ª—ë–Ω–Ω—ã—Ö" —Ä–∞–∑ –≤ –¥–µ–Ω—å
            if now.hour == 0 and now.minute == 0:
                already_notified.clear()

            for uid, cfg in list(reminders.items()):
                target_time = cfg.get("time")
                mode = cfg.get("mode", "daily")

                # –µ—Å–ª–∏ —Ä–µ–∂–∏–º —Ç–æ–ª—å–∫–æ –±—É–¥–Ω–∏, —Å–∫–∏–ø–∞–µ–º —Å—É–±–±–æ—Ç—É/–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
                if mode == "weekdays" and now.weekday() >= 5:
                    continue

                key = (uid, current_date)
                if target_time == current_time and key not in already_notified:
                    try:
                        state = user_state.get(uid)
                        if not state:
                            await bot.send_message(
                                uid,
                                "‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.\n–£ —Ç–µ–±—è –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–Ω –ø–ª–∞–Ω. –ù–∞–∂–º–∏ /problem, —á—Ç–æ–±—ã —Å—Ç–∞—Ä—Ç–∞–Ω—É—Ç—å."
                            )
                            already_notified.add(key)
                            continue

                        # –µ—Å–ª–∏ —Å—Ç–∏–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω
                        if not state.get("style"):
                            await bot.send_message(
                                uid,
                                "‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.\n–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å:",
                                reply_markup=style_kb
                            )
                            already_notified.add(key)
                            continue

                        day = state.get("day", 1)
                        base_task = get_task_for_state(uid)
                        if not base_task:
                            already_notified.add(key)
                            continue

                        if is_premium(uid) and uid in premium_profile:
                            text = get_premium_today_text(uid, base_task, day)
                        else:
                            text = f"üìÖ –î–µ–Ω—å {day}/7\n\n{base_task}"

                        await bot.send_message(
                            uid,
                            "‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ. –í–æ—Ç —Ç–≤–æ—ë –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:\n\n" + text
                        )
                        already_notified.add(key)
                    except Exception as e:
                        print("Reminder send error:", e)

        except Exception as e:
            print("Reminder worker error:", e)

        await asyncio.sleep(60)  # —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É


# ==============================
#            MAIN
# ==============================

async def main():
    load_data()
    bot = Bot(token=TOKEN)

    dp.message.register(start_handler, Command("start"))
    dp.message.register(help_handler, Command("help"))
    dp.message.register(reset_handler, Command("reset"))
    dp.message.register(problem_handler, Command("problem"))
    dp.message.register(today_handler, Command("today"))
    dp.message.register(done_handler, Command("done"))
    dp.message.register(status_handler, Command("status"))
    dp.message.register(premium_handler, Command("premium"))
    dp.message.register(premium_demo_handler, Command("premium_demo"))
    dp.message.register(premium_profile_handler, Command("premium_profile"))
    dp.message.register(remind_handler, Command("remind"))
    dp.message.register(text_router)

    # –∑–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    asyncio.create_task(reminder_worker(bot))

    await dp.start_polling(bot)


if __name__ == "__main__":
    asyncio.run(main())

